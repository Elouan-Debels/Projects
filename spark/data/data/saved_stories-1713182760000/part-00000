{"aid": "40037486", "title": "Reproducing the printer hack of Windows 95", "url": "https://dpolakovic.space/blogs/windows-95-printer-hack", "domain": "dpolakovic.space", "votes": 2, "user": "dpola", "posted_at": "2024-04-15 06:04:53", "comments": 0, "source_title": "Reproducing the printer hack of Windows 95", "source_text": "Reproducing the printer hack of Windows 95\n\n## Reproducing the printer hack of Windows 95\n\n12 Apr 2024 - Start me up!\n\nDuring my daily web crawl I encountered a very interesting [\u0261\u026af] that I\nhaven't seen in a long time. It was a hack of an unspecified version of\nWindows 95, which showed how to bypass the login screen with the help of the\nmenu and printing dialog. However, after a brief check, I found a fair amount\nof people stating that \"just hitting the cancel\" button would do the same.\nSharp-eyed viewers would notice that it was the very first action taken in the\npicture. In order to find out if the hack is real at all, I decided to\nreproduce it and document it for the good of the internet.\n\n### Analysis\n\nThe Windows 9x family ran on FAT file-system which does not support permission\nmodels. It was originally used for floppies and later for other portable media\nwhere permissions are simply not desired. You wouldn't want to throw away a\nperfectly fine floppy just because you can't delete the file on it from your\nSolaris machine... This means that all access rights on 9x's are managed on\nthe OS level only.\n\nIn addition, a new user can be added simply by entering new credentials on the\nlogin screen(!). While in the OS itself, users can encounter 4 types of\n\"permissions\": read-only, hidden, archive and system. However in standard\nterms, every user had read and execute permissions. And since all users can\nexecute the files with the archive permission, like File Explorer for example,\nthey can easily change the read-only attribute to false, de facto giving them\nthe write permission too.\n\nHowever, the login dialog shown in the picture was for a network and that's\nwhere things might get tricky. Accessing the client-server network does in\nfact require credentials, even on the 95. To crack the setup of Windows NT\n5.31 Domain Controller is beyond scope of this OS hack, but a user who has\naccessed the machine might just have enough tools to get in the network as\nwell.\n\n### Prerequisites\n\nI used a virtual machine since I don't have much hardware to spare. Here is my\nsetup and everything needed to reproduce it.\n\nHost machine\n\nVirtualBox 6.1.50 r161033 (Qt5.15.8) Debian 12.5\n\nVirtual machine*\n\nWindows 95 RTM (4.00.950) (FAT16) Windows 95 OSR2.5 (4.00.950 C) (FAT32)\nWindows 95 Boot Floppy FIX95CPU HP DeskJet 710C Series driver v10.3\n\nI started with Windows 95 v4.00.950, the very first release. As a rule of\nthumb, if there are going to be bugs, they are likely to appear in the initial\nversion. The 4.00.950 C is a somewhat special version. It is the final release\nof the 95 with some features which will come handy later. The boot floppy is\nneeded only for installation, and the FIX95CPU is necessary if your host has\nan equal/faster CPU than 2.1 Ghz.\n\n### Preparation\n\nAfter a fresh install, every user profile shares the same machine, from\nfolders to settings. In order to set up the user profiles, navigate to the\nControl Panel > Passwords > User Profiles and check the Users can customize\ntheir prefferences... option. Make sure to check two more checkboxes from User\nProfile Settings to include the network preferences. After a restart, every\nnew user that logs in can customize his machine to their needs. Now we can\nfocus on the printer.\n\nWindows 95 offers quite a lot of drivers for various printers. You can check\nthe list of printers in the Control Panel > Printers > Add Printers. However,\nthe HP DeskJet 710C is not included. Closest match with this device is HP\nDeskJet 560C which will work just fine. After all, every HP printer ending\nwith the letter \"C\" (and only \"C\", not \"C/PS\") will work too. The \"C\" stands\nfor \"Color\", and it is the color printer's Printing Properties dialog which we\nwill exploit.**\n\nThe next step would be to connect the VM to simple a peer-to-peer network. In\nthe network properties, enable the File and Print Sharing. Then we need to add\na new protocol as a component. Pick Microsoft as the manufacturer and select\nthe TCP/IP network protocol. When done, open the protocol properties and on\nthe IP Address tab add the IP address of your choice. Upon saving, the machine\nwill restart again.\n\nIn VirtualBox, navigate to network settings of the VM and enable the network\nadapter, attach it to Internal Network and in advanced options pick PCnet-FAST\nIII (Am79C973) adapter. Set the Allow All in Promiscuous Mode option. Now we\ncan clone the machine. Then, for the newly cloned machine, make sure to:\n\n  * generate new mac address in VirtualBox network settings\n  * change the machine name in Windows 95 network properties under Identification tab\n  * change the host identifier (last number) of the IP address in TCP/IP properties\n\nYou can now start both VMs. Create a new folder on one machine and share it on\nthe network via folder Properties. If everything was done correctly, you\nshould see both VMs in Windows 95 Network Neighborhood.\n\nLastly, the client-server network. We don't actually need to create new a\nWindows NT 3.51 server VM, because we can simulate its presence by registry\nedit. When disabling the Cancel button, Windows will try to validate the user\ninput with the server. Unless all three, username, password and domain name,\naren't checked with the server, the user won't be let in the system. It's the\nsame registry edit shown in the original gif. Obviously, without the presence\nof any server, we will lock our selves out of the system, so I recommend\ncreating a VM snapshot before the next step.\n\nIn regedit navigate to HKEY_LOCAL_MACHINE > Network > Logon. Open Edit menu\npick New > DWORD Value. In the right pane, a new empty line will be added.\nEnter MustBeValidated and then Modify the value. In a new dialog, change the\ncurrent value 0 to new 1. After another restart, users will not be able to\n\"cancel\" the login prompt.\n\n### Test\n\nLogin into Windows 95 virtual machine with the user name \"Bill\" and password\n\"Gates\". This user has a shared folder on the peer-to-peer network named\n\"Halloween files\" which contains one file called \"secret.txt\". Then start up\nthe second VM of which we don't know any credentials.\n\nAt the login prompt click the ? button and then the Cancel button. A help\nmessage will appear stating: Closes this dialog box withput saving any changes\nyou have made. Right-click the message and choose the Print Topic... option. A\nPrint window will appear. Make sure to select the HP DeskJet printer which has\nthe letter C in the name and click the Properties button.\n\nA new window with ColorSmart(tm) options will appear. Click the Help...\nbutton. On the new HP DeskJet help window menu bar pick options File > Open. A\nnew Open window will appear. Next to the Look in: combobox press the Up One\nLevel button (the one with the folder and arrow on it) until you get to the\nDesktop. Right click My Computer and select Open.\n\nWe are allowed into the system as default nameless user. Partially... The\nDesktop is not responsive, however the Start menu works and therefore the\nRun... does too. Also, the login prompt Enter Network Password is still\npresent.\n\nWhat now?\n\nNow we can easily revert the system hardening we've done during the\npreparation phase. Using rgedit we navigate again to the HKEY_LOCAL_MACHINE >\nNetwork > Logon. Since we are still logged as null profile, the registry will\nbe in the default state, without the DWORD value we've added. We will add it\nagain but this time we will keep the value 0. After that, we will be able to\nclose the login prompt.\n\nLet's open the Start > Find > File or Folders and enter the \"pwl\". Results\nwill list the Bill.pwl file that contains the login credentials for the user\nBill. Copy it on the Desktop or anywhere safe and then delete it from its\noriginal location. Right now we can insert the Microsoft Windows 95 CD-ROM\nExtras floppy number 5. This floppy contains the PWLEDIT.exe which can now\ndecrypt the passwords from the .pwl files we saved.***\n\nWhen we run PWLEDIT.exe we will be asked to enter the password for the user\nfrom new login prompt pop-up. Since we deleted the users .pwl file from\nC:\\Windows, we can assign new password to mentioned user. After this action, a\nnew .pwl file will be created in C:\\Windows with new password, and the PWLEDIT\nwindow will open. We can use it to decipher the password for the client-server\nnetwork.\n\n### Conclusion\n\nThe hack is real! It offers enough tools to gain access to the machine, peer-\nto-peer network and client-server network as well. A question arises. Will it\nalways work ? Sadly, no.\n\nThe printer hack itself will work, but when you disable password caching in\nthe registry editor, you won't be able to access any network, since the .pwl\nfiles won't be stored anymore. This is \"solved\" however, in later releases.\nYou see, the very last Windows 95 release I mentioned in prerequisites, offers\nthe Users option in the Control Panel. This allows us to change the password\nfor user profiles and therefore gain access to the peer-to-peer network. The\nsituation is same on 98FE and 98SE too. No luck for the client-server network.\nOnce there is nothing to decrypt, you are stuck.\n\nThere is, of course, a way how to perform this hack without a printer -\nthrough the power of MS-DOS prompt. By pressing F8 during startup, you could\nenter the MS-DOS mode only where you can utilize the regedit command. This\nwill require the knowledge of locating the registries in the system files. I\ncan not emphasize how awful work it is, but I would rather go to get the\nphysical DeskJet 710C than edit registries with the DOS prompt.\n\n* I prefer to use VirtualBox because I am unable to make QEMU/KVM work, since I am not a rocket scientist. I don't see the advantage of a package manager when I have to edit random config files and hunt for tutorials. Why this can't be managed by APT or explained by the developer/maintainer? Seriously, why this needs to be another Wine-like experience is beyond me.\n\n** If you want to install the 710C after all, you will encounter a few\nproblems. The HPDJ710C.INF file prevents the driver from being installed by\nthe \"Add Printer\" dialog and the HP's installation wizard requires a physical\ndevice to be connected via parallel port. The workaround may be manually\n(re)placing the HPFPNP.DLL, and any other files the driver requires, in\nC:\\Windows\\System. Honestly I don't know, but I will update this when/if I\nfind out.\n\n*** This was an official Microsoft tool, which you could freely download from\nhttp://www.microsoft.com/windows95/admintools.htm\n\nCopyright 2024 David Polakovic - This site is javascript and cookie free. The\nsource code is available here under GPLv3 license. Content of this web as well\nas photo of me with box on the head is licensed under CC BY-NC-ND 3.0.\n\n", "frontpage": false}
