{"aid": "39992749", "title": "Running a bakery on Emacs and PostgreSQL (2019)", "url": "https://bofh.org.uk/2019/02/25/baking-with-emacs/", "domain": "bofh.org.uk", "votes": 2, "user": "tosh", "posted_at": "2024-04-10 16:42:29", "comments": 0, "source_title": "Running a bakery on Emacs and PostgreSQL", "source_text": "Running a bakery on Emacs and PostgreSQL // Just a Summary\n\n# Just a Summary\n\nThe personal website of Piers Cawley (they/him) \u2014 Folk singer, photographer,\ncarer and occasional programmer.\n\n# Running a bakery on Emacs and PostgreSQL\n\nWritten by Piers Cawley on 2019-02-25\n\nJust over a year ago now, I finally opened the bakery I\u2019d been dreaming of for\nyears. It\u2019s been a big change in my life, from spending all my time sat in\nfront of a computer, to spending most of it making actual stuff. And stuff\nthat makes people happy, at that. It\u2019s been a huge change, but I can\u2019t think\nof a single job change that\u2019s ever made me as happy as this one.\n\nJust over a year ago now, I finally opened the bakery I\u2019d been dreaming of for\nyears. It\u2019s been a big change in my life, from spending all my time sat in\nfront of a computer, to spending most of it making actual stuff. And stuff\nthat makes people happy, at that. It\u2019s been a huge change, but I can\u2019t think\nof a single job change that\u2019s ever made me as happy as this one.\n\nOne of the big changes that came with going pro was that suddenly I was having\nto work out how much stuff I needed to mix to fill the orders I needed. On the\nface of it, this is really simple, just work out how much dough you need, then\nwork out what quantities to mix to make that much dough. Easy. You can do it\nwith a pencil and paper. Or, in traditional bakers\u2019 fashion, by scrawling with\nyour finger on a floured work bench.\n\nAnd that\u2019s how I coped for a few weeks early on. But I kept making mistakes,\nwhich makes for an inconsistent product (bread is very forgiving, you have to\nwork quite hard to make something that isn\u2019t bread, but consistency matters).\nI needed to automate.\n\nI\u2019d been on one of Bread Matters\u2019 \u201cBaking for a Living\u201d courses and as part of\nthe course materials had received a copy of a spreadsheet that could be used\nto go from a list of orders to a list of ingredients to mix alongside accurate\ncostings and other useful bits and bobs. It was great and certainly opened my\neyes to the possibilities for automation of this part of the job.\n\nAnd then I tried to add a new recipe.\n\nSpreadsheets aren\u2019t my favourite computational model so maybe it was just my\nlack of experience with them, but adding a new recipe was like pulling teeth;\nlots of tedious copying, pasting and repetition of formulae. It just seemed\nwrong, especially as the underlying computations were so straightforward\n(ish). There had to be a better way.\n\nThe key insight is that a bakery formula is so cliched that it can be\nrepresented as data. Here\u2019s the formula for seedy malt loaves:\n\nrecipe| ingredient| quantity  \n---|---|---  \nSmall Seedy Malt| Seedy malt dough| .61 kg  \nLarge Seedy Malt| Seedy malt dough| .92 kg  \n  \nOf course, that\u2019s not the full set of formulae, because it doesn\u2019t tell you\nhow to make \u2018Seedy malt dough\u2019, but that\u2019s just another formula, which\nconsists of flour, water, starter, salt and a multiseed \u2018soaker\u2019, where the\nstarter and the soaker are the results of other formulae, which are (finally)\nmade from basic ingredients. I did consider reaching for the object oriented\nhammer at this point, but thought that I might be able to do everything I\nneeded without leaving SQL. It was relatively straightforward to move the\nshape of the calculations in the Bread Matters spreadsheet into my database\nschema, the only real sticking point being the recursive nature of the\nformulae, but it turns out that recursive queries are a thing in modern SQL,\nalbeit a little tricky to get absolutely right first time. If you\u2019re curious\nabout the details of the schema, you can find it in my github repo for the\nbakery.\n\nSo now, a few days before a bake, I\u2019d setup my production_order table with the\norders for the bake, and run a query on the production_list view to find out\nwhat I needed to mix when. And all was great. Well, sort of. I had to add a\nbit extra onto the quantities in the initial starter mix to allow for the bits\nthat get stuck to the bowl and lost to the final dough, and it was all very\nwell until I wanted to bake two days in a row (a bake is a two day process\nfrom mixing the starters on a Wednesday evening, through mixing, fermenting\nand shaping on Thursday to baking the resulting loaves at four on Friday\nmorning). But, vitally, it was much, much easier to add and adjust formulae,\nand the limitations were no worse than the limitations of the spreadsheet. All\nwas well.\n\nIt\u2019s the nature of business that you need to keep records. How much got baked?\nHow much sold? Did we clean the floor? Were there any accidents? What sort?\nHow do we prevent them next time? The list is endless. It all needs to be\nrecorded, for both legal and pragmatic reasons. So I started a day book. This\nis just an .org file Every day I come into the bakery, I run org-capture and I\nget a template for the day\u2019s entry in the daybook, which I fill in as the day\ngoes on.\n\nOne of the features of org-mode is org-babel, a literate programming\nenvironment, which lets me write something like:\n\n    \n    \n    #+begin_src sql SELECT ingredient, quantity FROM bakehouse.production_list WHERE work_date = 'today'; #+end_src\n\nand then, with the cursor somewhere in the code block, hit C-c C-c whereupon\nEmacs will run that SQL against the bakery database and populate a table like:\n\ningredient| quantity  \n---|---  \nOld starter| 1.3  \nWater| 2.08  \nWhite flour| 2.6  \n...| ...  \n  \nIf that were all org-mode did to assist, it\u2019d be awesome enough, but the\nqueries I make are a little more complex than that, the current version of the\ndatabase understands about dates and can cope with overlapping bakes, but all\nthat makes the queries a little more complex. Org-mode helps with that too,\nbecause I can file away snippets of code in a \u2019library of babel\u2019 and just\nreference them from the daybook. And I can set arbitrary variables at any\npoint in the hierarchy of the document.\n\nSo I have a bit of code in my emacs config that tweaks the day\u2019s entry in a\ndaybook like so:\n\n    \n    \n    (defun pdc//in-bakery-daybook? () \"Are we in the bakery daybook?\" (equal (buffer-name) \"CAPTURE-loafery-daybook.org\")) (defun pdc/set-daybook-entry-properties () \"Set the properties we rely on in our boilerplated daybook queries\" (save-excursion (while (not (looking-at \"*+ [[:digit:]]\\\\{4\\\\}\\\\(-[[:digit:]]\\\\{2\\\\}\\\\)\\\\{2\\\\}\")) (org-up-element)) (let ((entry-date (first (s-split \" \" (org-entry-get (point) \"ITEM\"))))) (org-entry-put (point) \"header-args+\" (format \":var work_date=\\\"'%s'\\\"\" entry-date))) (org-babel-execute-subtree))) (defun pdc/org-capture-before-finalize-daybook-entry () (when (pdc//in-bakery-daybook?) (pdc/set-daybook-entry-properties))) (add-hook 'org-capture-before-finalize-hook #'pdc/org-capture-before-finalize-daybook-entry)\n\nIt won\u2019t win any code beauty contests, but it does the job of setting a\nwork_date variable for the day\u2019s entry and running any code in the subtree as\npart of the capture process. The capture template has lines like\n#+call:mixes(), which call the stored code snippets, that reference the\nvariable set in the current subtree and so make the query for the right day.\nThis means that all I have to do to know what I should be doing when I get\ninto the bakehouse is to run an org-capture and check the resulting entry in\nmy daybook. Provided, that is, that I\u2019ve added the appropriate rows to the\ndatabase.\n\n## Next steps\n\nThe software isn\u2019t done, of course, no software ever is. But it\u2019s good enough\nthat it\u2019s been managing my mixes without a hitch for the last few months,\ntelling me what to pack for which customer and generally removing the need to\nwork anything out with a pencil and paper. It\u2019s nowhere near as mature or\ncapable of commercial production management software, but it fits me. I\nunderstand what it does and why, how it does it, the limitations it has and\nhow to work around them. When it becomes annoying enough, I might sit down and\nwork out how to fix it, but I\u2019ll do that when I\u2019m in the right frame of mind.\nMy current list of niggles looks something like this:\n\nAccounting\n\n    The database already knows how to do costings based on raw ingredient costs etc, but I should probably be able to use it to keep my books as well, using org-ledger\nParametric recipes\n\n    At a certain point, it becomes easier to mix a \u2018stiff starter\u2019 in my mixer than it is to just mix the usual wet starter by hand. This breakpoint comes at around 3kg of flour. Right now, I manage this by looking at the mixes for my starters and, if it looks like a lot, changing the order to use 2-stage versions of the formulae and running the query again. I think it should be possible to automate this through a more sophisticated query, but I need to work that out.\nBetter scheduling\n\n    things get weird if a batch of dough would be more than I can mix in a single go. Right now there are other physical limitations that mean that I simply can\u2019t make that much bread anyway, but once I get a few more bannetons and racks, this will become a much more pressing issue.\nOrder management\n\n    Right now, I manage orders through Postico talking to the database, which is okay, but a little frustrating in places. An autocompleting environment for orders within emacs would be a much neater way to manage things.\n\n## Putting the personal in personal computing\n\nComputers are amazing. They are versatile tools even if you don\u2019t know how to\nprogram them, because there\u2019s almost always an app for what you want, or\nsomething close enough that you cant work around its infelicities. It\u2019s quite\nremarkable the things that folks can do with their kit with no programming\nskill at all.\n\nBut... learn to program, and a whole other vista of possibility opens up to\nyou. With good programmable tooling you\u2019re only really limited by your skill\nand understanding. Instead of accommodating yourself to your software, you can\naccommodate your software to you, and make the right functionality trade-offs\nfor you. There\u2019s a brilliant commercial piece of music looping sofware I use\nthat could be massively more brilliant if there were a way of picking up the\ntempo automatically from the first recorded loop - it would free me from\nhaving to sing to a click and generally make the whole process easier. The\ndevelopers have other (understandable) priorities, like porting the app to\nwindows. And they\u2019re not wrong to do so. There were folk clamoring for a\nwindows version, and if a developer isn\u2019t making money from a commercial\napplication, then development will stop. I\u2019m definitely not complaining, the\nfeature is not so dramatically necessary that I\u2019m prepared to spend the time\nlearning how to do real time music programming in order to implement it, but\nif I want software to dance to my tune then doing it myself is the only way.\n\nSo... choose tools that let you program them. I choose emacs and PostgreSQL,\nyou might choose vim and SQLite or Atom and a NoSQL database, or you might\njust live in your Smalltalk image. Once you start to see your computing\nenvironment as truly soft and malleable, you can do amazing things, assisted\nby a computer that is truly yours.\n\n  * 0 likes\n  * 1 like\n  * 0 replies\n  * 24 mentions\n\n### Reposts\n\n  * calvin\n\n### Other Mentions\n\n  * Thomas \ud83c\udf44 #masks4all https://twitter.com/__tosh\n\n\u201cOnce you start to see your computing environment as truly soft and malleable,\nyou can do amazing things, assisted by a computer that is truly yours.\u201d\n@pdcawley on running a \ud83c\udf5e bakery w/ emacs and postgresql\nbofh.org.uk/2019/02/25/bak...\n\nTue, 12nd May, 2020 7:49pm +0000\n\n  * Carlos Neira https://twitter.com/CarlosN26157061\n\nbofh.org.uk/2019/02/25/bak...\n\nTue, 2nd Jun, 2020 12:41pm +0000\n\n  * Aulis Vainionp\u00e4\u00e4 https://twitter.com/AulisVainionpaa\n\nMielenkiintoista lukea vanha juttu tyypist\u00e4, joka py\u00f6ritt\u00e4\u00e4 Emacsin avulla\nleipomoa. bofh.org.uk/2019/02/25/bak...\n\nWed, 3nd Mar, 2021 10:26pm +0000\n\n  * Angsuman Chakraborty https://twitter.com/angsuman\n\nRunning a Bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 5:45pm +0000\n\n  * HN Front Page https://twitter.com/hn_frontpage\n\nRunning a Bakery on Emacs and PostgreSQL L: bofh.org.uk/2019/02/25/bak... C:\nnews.ycombinator.com/item?id=265316...\n\nSun, 21nd Mar, 2021 5:36pm +0000\n\n  * Hacker News https://twitter.com/HNTweets\n\nRunning a Bakery on Emacs and PostgreSQL: bofh.org.uk/2019/02/25/bak...\nComments: news.ycombinator.com/item?id=265316...\n\nSun, 21nd Mar, 2021 5:40pm +0000\n\n  * Thomas Schranz \ud83c\udf44 https://twitter.com/__tosh\n\n\ud83e\uddd1\ud83c\udffc\ud83c\udf73\ud83c\udf5e Running a bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak... by\n@pdcawley\n\nSun, 21nd Mar, 2021 6:12pm +0000\n\n  * HackerNewsTop10 https://twitter.com/HackerNewsTop10\n\nRunning a Bakery on Emacs and PostgreSQL Link: bofh.org.uk/2019/02/25/bak...\nComments: news.ycombinator.com/item?id=265316...\n\nSun, 21nd Mar, 2021 6:05pm +0000\n\n  * HsiangHui https://twitter.com/hsianghui\n\nRunning a bakery on Emacs and PostgreSQL -- Just a Summary #hn\nbofh.org.uk/2019/02/25/bak...\n\nSat, 16nd May, 2020 1:43am +0000\n\n  * Joe Jones https://twitter.com/Onlypizza1\n\nRunning a Bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 7:20pm +0000\n\n  * Hacker News 20 https://twitter.com/betterhn20\n\nRunning a Bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak...\n(news.ycombinator.com/item?id=265316...)\n\nSun, 21nd Mar, 2021 6:46pm +0000\n\n  * Hacker News\u8a18\u4e8b\u984c\u65e5\u672c\u8a9e\u7ffb\u8a33 https://twitter.com/hackernewsj\n\nEmacs\u3068PostgreSQL\u3067\u30d1\u30f3\u5c4b\u3092\u7d4c\u55b6\u3059\u308b bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 8:12pm +0000\n\n  * Hacker News https://twitter.com/newsycombinator\n\nRunning a Bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 8:00pm +0000\n\n  * nixCraft https://twitter.com/nixcraft\n\nRunning a bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 8:28pm +0000\n\n  * Hacker News 50 https://twitter.com/betterhn50\n\nRunning a Bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak...\n(news.ycombinator.com/item?id=265316...)\n\nSun, 21nd Mar, 2021 8:16pm +0000\n\n  * Hacker News https://twitter.com/newsycombinator\n\nRunning a Bakery on Emacs and PostgreSQL (2019) bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 9:04pm +0000\n\n  * Herr Kyber https://twitter.com/KyberHobo\n\nJeder muss seine Br\u00f6tchen backen, daher verwundertes mich nicht, dass dieser\nPost an die Spitze von HN aufgegangen ist. bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 9:08pm +0000\n\n  * \u7530\u6240 \u99ff\u4f51 | Shunsuke Tadokoro https://twitter.com/todokr\n\nEmacs\u306a\u3089\u30d1\u30f3\u5c4b\u3060\u3063\u3066\u958b\u3051\u308b bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 10:07pm +0000\n\n  * Hacker News 100+ https://twitter.com/HackerNews100\n\nRunning a Bakery on Emacs and PostgreSQL (2019) bofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 10:40pm +0000\n\n  * M157q News RSS https://twitter.com/M157q_News_RSS\n\nRunning a Bakery on Emacs and PostgreSQL (2019) bofh.org.uk/2019/02/25/bak...\nArticle URL: https://t.co/PvDcY1KRnw Comments URL:\nnews.ycombinator.com/item?id=265316... Points: 100 # Comments: 28\n\nSun, 21nd Mar, 2021 10:46pm +0000\n\n  * Jeremy Lu https://twitter.com/thecat\n\n\u7b49\u7b49 \u958b\u500b\u9eb5\u5305\u5e97\u8981\u5148\u6703 emacs + postgrsql!!(\u4e0d\u80fd\u7528 excel \u9802\u591a airtable \u5c31\u597d\u55ce?\ud83d\ude2c\nbofh.org.uk/2019/02/25/bak...\n\nSun, 21nd Mar, 2021 11:59pm +0000\n\n  * High S/N HN https://twitter.com/HighSNHN\n\nRunning a Bakery on Emacs and PostgreSQL (2019): bofh.org.uk/2019/02/25/bak...\n( news.ycombinator.com/item?id=265316... )\n\nMon, 22nd Mar, 2021 9:00am +0000\n\n  * Yohan J. Rodr\u00edguez https://twitter.com/hasdid\n\n#Tech #Automated | Running a Bakery on Emacs and PostgreSQL bofh.org.uk/2019/02/25/bak...\n\nSat, 27nd Mar, 2021 10:46pm +0000\n\n  * Yassine Serhrouchni https://twitter.com/coolyass\n\nJe suis partiellement d'accord avec toi mais je ne r\u00e9siste pas \u00e0 l'envie de te\npartager \u00e7a: bofh.org.uk/2019/02/25/bak...\n\nSat, 15nd Jan, 2022 10:22pm +0000\n\n\u00a92003\u20132024 Piers Cawley. See the colophon for how I built this.\n\n", "frontpage": false}
