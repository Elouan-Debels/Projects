{"aid": "40038759", "title": "Weird monitor bugs people sent me in the last 5 years. (2022)", "url": "https://notes.alinpanaitiu.com/Weird-monitor-bugs", "domain": "alinpanaitiu.com", "votes": 1, "user": "fanf2", "posted_at": "2024-04-15 10:42:04", "comments": 0, "source_title": "Weird monitor bugs people sent me in the last 5 years - Alin Panaitiu", "source_text": "Weird monitor bugs people sent me in the last 5 years \u2014 Alin Panaitiu\n\n\u25c0 Back to NotesPublished on August 28, 2022\n\n# Weird monitor bugs people sent me in the last 5 years\n\nI develop \ud83c\udf15 Lunar, a macOS app for getting intelligent adaptive brightness on\nexternal monitors and controlling every aspect of your monitor using DDC and\nother obscure protocols.\n\nI get tons of email about Lunar, especially after it became my full time \u201cjob\u201d\nin 2021. A lot of those emails complain about Lunar bugs, but sometimes, after\na good multi day chase, I conclude it\u2019s actually a monitor bug and the user\nhas to kind of.. deal with it.\n\n\u201dBuy another monitor\u201d is never a good response, so I try to help and provide a\nworkaround whenever I can.\n\nBut anyway, here\u2019s a small collection of those bugs.\n\n## # Dual monitors swapped positions\n\nYou know how people get two identical monitors and place them side by side for\na neat ultrawide-like look.\n\nWell a lot of those people experience a very annoying behavior: After standby\nor restart, the monitors get swapped by the OS, so moving the cursor to the\nleft monitor will actually appear on the right monitor, and vice-versa.\n\nIf the monitors also had some of the settings different, like resolution or\ncolor profile, those also get swapped.\n\nThis doesn\u2019t happen for Apple vendored monitors like the Pro Display XDR in\nthe above image, and you\u2019ll see why in a minute.\n\n#### # How monitor settings are stored\n\nWhenever you arrange monitors, the system has to store those coordinates\npersistently and restore them when the monitor reconnects. In standby, the\nmonitor is actually disconnected and disappears from the I/O Registry, so on\nsystem wake, it reconnects and the OS has to rearrange based on the stored\nsettings.\n\nTo store something persistently, you need to have a way of identifying that\nmonitor precisely. So the OS computes an UUID from whatever it can find inside\nthe data provided by the monitor.\n\nThat data is called the EDID structure and it contains things like vendor ID,\nweek/year of manufacture, serial number etc.\n\n#### # Why does this happen?\n\nThe problem comes from vendors who flash the same exact firmware with the same\nEDID to multiple monitors in the same batch.\n\nSerial number is emphasized above especially because by definition it should\nbe a unique number that increments with each monitor. Well it doesn\u2019t. And it\nhas nothing to do with the serial number you see on the back of the monitor or\nthe box or wherever it\u2019s placed.\n\nSo if you have the bad luck to buy two identical monitors, from the same\nbatch, with the same EDID, then the OS will compute the same UUID for both.\n\nThat means that on reconnection, the monitors will look identical from the OS\nside, so the stored settings will have to be assigned randomly for each\nmonitor. That will sometimes, not always, but deterministically when it's most\nannoying, cause the swapping bug.\n\nAnd there\u2019s nothing you can do to fix it.\n\n#### # Workaround\n\nThe simplest solution is present in Lunar's Shortcuts (available without a Pro\nlicense):\n\n  * Swap Monitors to fix arrangement on setups with 2 monitors\n  * Fix Monitor Arrangement for setups with 3 or more monitors\n\nDemo of how Fix Monitor Arrangement works\n\nFor people that don't want to use Lunar, I wrote a simple CLI for swapping\nmonitors here:\n\nmac-utils/SwapMonitors.swift \u00b7 GitHub\n\n##### # Installation\n\n  * You can either install it from the Terminal:\n\n    \n    \n    export BINDIR=/usr/local/bin export BINURL=\"https://github.com/alin23/mac-utils/raw/main/bin/SwapMonitors\" mkdir -p \"$BINDIR\" && \\ curl \"$BINURL\" > \"$BINDIR/SwapMonitors\" && \\ chmod +x \"$BINDIR/SwapMonitors\"\n\n  * Or use a Shortcut that does that automatically\n\nThe shortcut also provides a way to bind a hotkey, or run it from the menu\nbar.\n\n##### # Usage\n\n  * Just run it and let the algorithm find the monitors that should be swapped: (either press the hotkey you assigned to the Shortcut, or run it from the command line)\n\n    \n    \n    \u2301 \u276f SwapMonitors Swapping Dell U2719D (2) [ID: 17] with Dell U2719D (1) [ID: 18] External Display 1: x=4872.0 y=0.0 width=2560.0 height=1440.0 Moving to: x=1800.0 y=0.0 External Display 2: x=1800.0 y=0.0 width=3072.0 height=1620.0 Moving to: x=4872.0 y=0.0\n\n  * Or pass the IDs of the monitors to swap as arguments\n\n    \n    \n    \u2301 \u276f SwapMonitors print-ids IDs of monitors in order of appearance from left to right: [17, 19, 18] Names of monitors in order of appearance from left to right: [\"Dell U2719D (2)\", \"LG Ultrafine\", \"Dell U2719D (1)\"] \u2301 \u276f SwapMonitors 17 18 Swapping Dell U2719D (2) [ID: 17] with Dell U2719D (1) [ID: 18] External Display 1: x=1800.0 y=0.0 width=2560.0 height=1440.0 Moving to: x=4360.0 y=0.0 External Display 2: x=4360.0 y=0.0 width=3072.0 height=1620.0 Moving to: x=1800.0 y=0.0\n\n## # Monochrome HDR\n\nWhile developing external monitor support for XDR Brightness, I needed a way\nto test it.\n\nAnd since I don't have a 600nits+ monitor, I reached out to my friend Istv\u00e1n\nT\u00f3th, the developer of BetterDisplay (and also a previous Lunar user who\nbecame a MonitorControl maintainer by porting Lunar's M1 DDC code to\nMonitorControl, long story).\n\nWhen Istv\u00e1n turned on XDR Brightness on his Lenovo Creator Extreme, it was\nsuddenly stripped of all color and everything became grayscale on it.\n\nOther Lunar users also mentioned this issue on other specific monitor models,\neven before XDR Brightness was a thing. I thought I had an idea then on what\ncould cause this, but this new data point dismantled my previous theory.\n\nSome causes I can think of:\n\n  * The macOS ICC profile for that monitor computes a 0 chroma value in specific Gamma table configurations\n  * The monitor internal color profile/preset is reverted to some default value on receiving a DDC command that's not handled correctly\n  * The grayscale filter of macOS is enabled somehow? \u0304\\\\_(\u30c4)_/ \u0304\n\nIn the end, I have no idea what causes the problem, I simply disabled XDR for\nexternal monitors by default in Lunar, and made it opt-in.\n\n## # Blacking out\n\nThis is the bug that causes the most angry and panicky emails I get.\n\nOn receiving specific DDC commands, some monitors simply go black and stop\nresponding to any user input.\n\nReconnecting the video cable doesn't do anything, the power button doesn't\nwork, from the user perspective it looks like Lunar just bricked their\nmonitors.\n\nThe fix is simple: unplug the power cable, and plug it back again\n\n#### # What's happening?\n\nI have an idea.\n\n###### # Firmware bugs\n\nSince Lunar doesn't do anything unusual (it just sends standard DDC commands\nfor setting brightness and contrast), I assume the bug is in the DDC handler\ncode inside the monitor controller firmware.\n\nIt's possible that either a specific series of bytes, or a burst of DDC\nmessages, causes the firmware to crash, and maybe even enter in a tight loop\nsince it doesn't seem to restart itself.\n\nI keep an extensive FAQ with possible monitor features and settings that can\nbreak DDC and even cause this bug in specific setups: FAQ - The brightness or\nvolume doesn't change\n\n###### # Long cables\n\nOn rare occasions, the issue was actually being caused by a too long\nThunderbolt cable.\n\nMost people don't know that there's no such thing as a 6 meter Thunderbolt\ncable, not without built-in signal amplifiers or fiber optics and expensive\nconverter chips.\n\nSo, expectedly, when using the data channel for DDC for longer than a few\nmilliseconds, the video signal will drop completely, or revert to a much lower\nresolution and refresh rate.\n\n###### # Custom color profiles\n\nIn other cases, the issue was a custom color profile, and the problem was\nactually caused by a macOS bug.\n\nOne Lunar user was an astronomer, and had a self-made observatory at home. He\ncreated a color profile that pushed most colors towards dark red, to keep his\nnatural night vision when working.\n\nBut when Lunar adjusted the Gamma tables, the macOS color formula was\nsometimes reaching a point where every color computed to rgb(0, 0, 0).\n\nThe Lunar adjustments were completely normal and well within the documented\nrange, and I found no way to predict on what values would the system reach\nthat point.\n\nI had to add a periodic timer that checks if the macOS color curve gets to 0,\nand reset all color adjustments, then forcefully disable that functionality\nfor the user and let him know about it.\n\n## # Switching input just blinks the screen\n\nThe DDC protocol (or more exactly the Monitor Control Command Set (MCCS)\nspecification), defines a command for switching monitor inputs.\n\nSo you might have:\n\n  * a MacBook on the Thunderbolt input of your monitor\n  * a PlayStation on the HDMI1 input\n  * a Raspberry Pi on HDMI2\n\nAnd to switch between those, you can fiddle with the monitor buttons, or you\ncan do that with handy keyboard shortcuts through DDC.\n\nBecause KVMs are expensive, I implemented that functionality in Lunar for\npeople that don't really need the \"keyboard switching\" part of a KVM, but\nmostly the \"video switching\" part.\n\n##### # So, where's the bug?\n\nThe thing is, some monitors lie about this functionality.\n\nEven if the monitor reports that the VCP code 0x60 for Input Select is\nimplemented, when any input value is sent, the monitor just blinks. By that I\nmean it goes black for a second, then returns to the previous image.\n\nThere's no software fix for these monitors.\n\n## # Mute command doesn't do anything\n\nKind of in the same vein as with the input switching bug above, the DDC Mute\ncommand just doesn't do anything on some monitors.\n\nThe odd thing is that the monitors do have a mute switch in their OSD, but\nit's not controllable by the VCP code 0x8D for Audio Mute.\n\nInstead, on some monitors, it seems that setting the volume to some non-\nstandard value like 255 (or -1 if we flip from unsigned to signed integers),\nmight affect the volume setting. On most monitors though, it doesn't do\nanything at all.\n\nThat's another workaround that got its own section in Lunar's settings because\nof how often it's encountered.\n\n", "frontpage": false}
