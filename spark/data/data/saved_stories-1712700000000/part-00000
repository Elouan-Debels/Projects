{"aid": "39980806", "title": "How I Restored a 15TB YugabyteDB Database from an Amazon S3 Backup in 30 Minutes", "url": "https://www.yugabyte.com/blog/rapid-data-recovery-database-amazon-s3/", "domain": "yugabyte.com", "votes": 6, "user": "kkgeorge", "posted_at": "2024-04-09 15:58:53", "comments": 0, "source_title": "15TB YugabyteDB Database Restore From S3 in 30 Minutes", "source_text": "15TB YugabyteDB Database Restore From S3 in 30 Minutes\n\nSkip to content\n\n  * Sign In\n  * Get Started\n\n    * Try YugabyteDB Managed FreeCloud database managed by us\n    * Download YugabyteDBFree open source database\n    * Book a DemoPersonalized demo\n\nBack to Blog Home\n\n# Rapid Data Recovery: Restoring a 15TB YugabyteDB Database From an Amazon S3\nBackup in 30 Minutes\n\nKuriakose George Kulangara\n\nApril 9, 2024\n\nEfficiency and reliability are crucial in database management. Every minute of\ndowntime can cost the company a lot of money and negatively impact its\nreputation. Robust backup and recovery solutions are essential for mitigating\ndata loss and enabling swift operational recovery. In this blog post, I will\ndemonstrate how to restore a massive 15TB YugabyteDB database from an Amazon\nS3-based backup in less than 30 minutes.\n\n## When Disaster Strikes: The Importance of Rapid Data Recovery for Databases\n\nIn situations where hardware failures, human errors, data center outages, or\nregional outages compromise essential data, rapid data recovery is paramount\nto avoid financial losses and reputational damage. YugabyteDB, a distributed\nPostgreSQL database engineered for massive workloads and high availability,\nprovides advanced backup and restore capabilities. Its distributed\narchitecture ensures data is restored swiftly, minimizing downtime and\ndisruption when disaster strikes.\n\n## How YugabyteDB Database Ensures Rapid Data Recovery\n\n### Configuring the Cluster\n\nTo begin, I created a database cluster using our self-managed deployment of\nYugabyteDB(i.e. YugabyteDB Anywhere) consisting of nine M6i.4XLarge EC2\ninstances spread across 3 availability zones, each having a 3 TB EBS volume\nconfigured with 6000 IOPS and 1000 MB/sec throughput. This distributed\nconfiguration ensures data redundancy and fault tolerance, crucial for\nmaintaining data integrity and availability. The database itself has 3 tables\n(shown below).\n\n### Swift Restoration: Leveraging yb-controller for Rapid Data Recovery\n\nIn this scenario, a disaster or critical event has resulted in the loss of the\noriginal cluster. However, thanks to the backup strategy leveraging S3\nstorage, administrators can confidently initiate the recovery process.\n\nI created the 9-node cluster in 6 minutes and, utilizing the yb-controller,\nrestored a 15 TB Yugabyte database across the 9 nodes in just 30 minutes and\n52 seconds (see screenshot below). This highlights YugabyteDB\u2019s scalability\nand demonstrates its ability to handle massive datasets and recover swiftly\nfrom backups stored in the cloud. Adding cluster creation time, RTO (Recovery\nTime Objective) is approximately 37 mins. Notably, the data is fully restored\nwithout the need for background rehydration, meaning that the database is\nready to go back into production with no performance loss.\n\n### Database Backup in a Flash: Securing Data in 11 Minutes\n\nBut what about the backup process itself? When it comes to data management,\nspeed and efficiency are crucial to minimize potential disasters. YugabyteDB\nenables database administrators to quickly create backups, ensuring readiness\nfor any scenario.\n\nIn my setup, backing up the entire 15 TB database took just 11 minutes, thanks\nto advanced backup mechanisms and streamlined processes. Note that the size of\nthe backup is 5TB since the replication factor (RF) for this cluster is 3.\nThis rapid backup process securely stores critical data in S3, ensuring\nimmediate availability for retrieval in the event of unforeseen circumstances.\n\n## What is yb-controller and How It Enables Unprecedented Efficiency\n\nNow, let me walk you through the technology behind this swift data recovery\nprocess: yb-controller. Released with YugabyteDB 2.16, yb-controller brings\nunparalleled efficiency and reliability to backup and recovery processes.\n\nyb-controller orchestrates the entire data recovery process, leveraging cloud\nstorage and YugabyteDB\u2019s distributed architecture. Its intelligent algorithms\nand parallel processing capabilities enable swift retrieval and restoration of\nthe 15 TB database from S3 storage across nine instances in just 30 minutes,\nhighlighting its scalability and efficiency in managing massive datasets.\n\nYugabyteDB users can trust yb-controller for complete data protection and\nquick recovery (within minutes), even in the face of the most challenging\nscenarios. Whether it\u2019s restoring a 15 TB database from an S3-based backup or\ncreating backups in record time, yb-controller revolutionizes the way\nbusinesses approach data recovery.\n\nWhen the YugabyteDB Anywhere initiates backups, it assigns one of the yb-\ncontrollers as the orchestrator, to create snapshots* and identify nodes with\ntablet leaders. The orchestrator then delegates the upload to each of the yb-\ncontroller\u2019s on the nodes that have the respective tablet leaders. A success\nmarker file, containing backup metadata, is uploaded once the backup is\ncompleted. During restore, the process is done in reverse, with the addition\nof writing data for all replicas of each tablet.\n\n*NOTE: The process for taking snapshots, moving them to external storage, and restoring from backups is detailed in the documentation for YSQL and YCQL.\n\nThe time needed for restore depends on several factors such as the size of\ndata, the number of nodes, the number of cores per node, the replication\nfactor, the number of tables, the number of tablets in each table, the number\nof cores in each node, the disk throughput, disk IOPS, etc. Of these, the most\nimportant factors are:\n\n  * Number of nodes\n  * Replication factor\n  * Disk throughput\n  * Size of backup\n\nIn my sample restore, I was able to write the full 15 TB in 30 minutes and 52\nseconds. This means I am able to utilize almost all of the disk throughput\nprovisioned, which is 9*1000 MB/sec (8.79 GB/sec). So restoring a smaller\ndatabase (say with 500 GB of data) would take about 1 minute.\n\nThe yb-controller supports data backups to most of the popular object storage\nincluding Amazon S3, Google Cloud Storage, Azure Cloud Storage, and NFS. It\ncan also do incremental backups which reduces the time needed for backups and\nuses an even lower amount of resources.*\n\nAnother significant advantage of yb-controller-based backups is that these\nbackups can be restored to a YugabyteDB cluster that has a different\nreplication factor from the source.\n\n*Restore time is constant and does not depend on the number of incremental backups present.\n\n### Why Not Do EBS Volume Snapshots?\n\nOne of the questions I usually get asked is why not just do EBS volume\nsnapshots since the RTO would be much shorter. Yes, that is true \u2014 EBS volume\nsnapshots will have shorter RTO, but there are some significant drawbacks.\nThese include:\n\n  * Significantly higher costs.\n  * The inability to backup and/or restore specific databases selectively.\n  * Restricted to only restoring to a YugabyteDB cluster with an identical replication factor.\n  * Inability to restore to a YugabyteDB cluster in a different region.\n  * Backup data being stored in the same account as production data.\n\n### Conclusion: Embracing Innovation for Resilient Data Management\n\nThe world of data management is continuously changing, and innovation is the\nonly way to keep pace. The ability to recover a 15 TB YugabyteDB database from\nan Amazon S3 backup in 30 minutes is a testament to the role that technology\nplays in ensuring the survival and persistence of data. For comparison, a\nbackup of a 4TB PostgreSQL database to object storage takes 95 hours and\nrestore takes about 10 hours. (See <Disaster Recovery with Very Large Postgres\nDatabases at 16:15)\n\nThe need for robust backup and recovery solutions will only grow as businesses\ncontinue to evolve. YugabyteDB enables organizations to enhance database\nmanagement, focusing on critical safety and recoverability. With every minute\ncrucial, yb-controller offers fast data recovery, helping businesses maintain\noperations during challenges.\n\nApril 9, 2024\n\nAmazon S3Backupsyb-controller\n\nKuriakose George Kulangara\n\nApril 9, 2024\n\n#### Related Posts\n\n### Backup and Restore Your Business-Critical Apps with YugabyteDB and\nCommvault\n\n1 month ago\n\n### Boost Database Performance with Faster Backups and Restores and Self-\nService IOPS Provisioning\n\n8 months ago\n\n### Using MinIO for YugabyteDB Backup and Restore\n\n2 years ago\n\nGet your free report to discover YugabyteDB and the latest in cloud database\ntechnology.\n\nGet Report\n\n## Popular Topics\n\n### PostgreSQL Compatibility\n\n### Database Migration\n\n### Database Sharding\n\n### Geo-Distribution\n\n### Customer Stories\n\n### Change Data Capture\n\n## Categories\n\nACID TransactionsAmazon AuroraAmazon DynamoDBAmazon Web ServicesApache\nCassandraCareersCloud ProvidersCockroachDBCommunity NewsCompany NewsCompare\nand contrastContainersCustomersDatabase ArchitectureDatabase\nMigrationDatabasesDistributed SQLDistributed SQL SummitDockerEcosystem\nIntegrationsGeo-DistributionGoogle Cloud PlatformGoogle SpannerGraphQLHow It\nWorksHow ToIntegrationsJepsen TestsKafkaKubernetesMicrosoft AzureMicrosoft\nAzure Cosmos DBMongoDBOn-PremisesOpen SourcePartnersPerformance\nBenchmarksPivotal Container Service (PKS)PostgreSQLRelease\nAnnouncementsRetailSecuritySpringStreaming IndustryUse CasesWeek in\nReviewYugabyteDBYugabyteDB AnywhereYugabyteDB ManagedYugabyteDB\nTrainingYugabyteDB Voyager\n\n## Explore Distributed SQL and YugabyteDB in Depth\n\nDiscover the future of data management.\n\nLearn at Yugabyte University\n\nGet Started\n\nBrowse Yugabyte Docs\n\nExplore docs\n\nPostgreSQL For Cloud Native World\n\nRead for Free\n\n  *     * Product\n\n      * YugabyteDB\n      * YugabyteDB Voyager\n      * Deployment Options\n      * Pricing\n    * Company\n\n      * About Yugabyte\n      * Press\n      * Careers\n      * Trust Center\n      * Contact\n      * Legal\n  *     * Solutions\n\n      * BY USE CASE\n\n        * Database Modernization\n        * Cloud Native Apps\n        * Edge and Streaming Apps\n      * BY INDUSTRY\n\n        * Financial Services\n        * Retail and eCommerce\n        * Telecommunications\n      * BY CLOUD\n\n        * AWS\n        * Google Cloud\n        * Microsoft Azure\n  *     * Community\n\n      * Get Involved\n      * Events\n      * YugabyteDB Friday Tech Talks\n      * Distributed SQL Summit\n      * Slack\n      * GitHub\n    * Resources\n\n      * Developer Hub\n      * Docs\n      * Yugabyte University\n      * Key Concepts\n      * Support\n      * Forum\n      * Success Stories\n      * Blog\n      * Content Library\n      * FAQ\n\n\u00a9 2024 YUGABYTE, INC. All rights reserved.\n\nTerms of Service Privacy Policy Cookie Policy Your California Privacy Choices\n\n", "frontpage": false}
