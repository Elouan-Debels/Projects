{"aid": "40065633", "title": "Aggressive Pok\u00e9mon Gameplay Highlights Prompting Hurdles and Promise for LLMs", "url": "https://community.aws/content/2eVAc9JN5iKjxntxq1EiwN3wQW1/five-llms-battled-pokemon-claude-opus-was-super-effective", "domain": "community.aws", "votes": 2, "user": "banjtheman", "posted_at": "2024-04-17 15:00:03", "comments": 0, "source_title": "Five LLMs battled Pokemon. Claude Opus was super effective", "source_text": "Community | Five LLMs battled Pokemon. Claude Opus was super effective\n\n## Select your cookie preferences\n\nWe use essential cookies and similar tools that are necessary to provide our\nsite and services. We use performance cookies to collect anonymous statistics\nso we can understand how customers use our site and make improvements.\nEssential cookies cannot be deactivated, but you can click \u201cCustomize cookies\u201d\nto decline performance cookies.\n\nIf you agree, AWS and approved third parties will also use cookies to provide\nuseful site features, remember your preferences, and display relevant content,\nincluding relevant advertising. To continue without accepting these cookies,\nclick \u201cContinue without accepting.\u201d To make more detailed choices or learn\nmore, click \u201cCustomize cookies.\u201d\n\n## Customize cookie preferences\n\nWe use cookies and similar tools (collectively, \"cookies\") for the following\npurposes.\n\n### Essential\n\nEssential cookies are necessary to provide our site and services and cannot be\ndeactivated. They are usually set in response to your actions on the site,\nsuch as setting your privacy preferences, signing in, or filling in forms.\n\n### Performance\n\nPerformance cookies provide anonymous statistics about how customers navigate\nour site so we can improve site experience and performance. Approved third\nparties may perform analytics on our behalf, but they cannot use the data for\ntheir own purposes.\n\nAllowed\n\n### Functional\n\nFunctional cookies help us provide useful site features, remember your\npreferences, and display relevant content. Approved third parties may set\nthese cookies to provide certain site features. If you do not allow these\ncookies, then some or all of these services may not function properly.\n\nAllowed\n\n### Advertising\n\nAdvertising cookies may be set through our site by us or our advertising\npartners and help us deliver relevant marketing content. If you do not allow\nthese cookies, you will experience less relevant advertising.\n\nAllowed\n\nBlocking some types of cookies may impact your experience of our sites. You\nmay review and change your choices at any time by clicking Cookie preferences\nin the footer of this site. We and selected third-parties use cookies or\nsimilar technologies as specified in the AWS Cookie Notice.\n\n## Unable to save cookie preferences\n\nWe will only store essential cookies at this time, because we were unable to\nsave your cookie preferences.\n\nIf you want to change your cookie preferences, try again later using the link\nin the AWS console footer, or contact support if the problem persists.\n\nHomeTags\n\nFeatured Spaces\n\nCost Optimization\n\nDevOps\n\nGenerative AI\n\nKubernetes\n\nLivestreams\n\nResilience\n\nTraining and Certification\n\nCommunity Programs\n\nAWS Heroes\n\nAWS Community Builders\n\nAWS User Groups\n\nStudent Communities\n\n# Five LLMs battled Pokemon. Claude Opus was super effective\n\n## Gotta prompt \u2018em all!\n\ngenerative-aiamazon-bedrock\n\nBanjo Obayomi\n\nAmazon Employee\n\nPublished Apr 17, 2024\n\nComments (2)2\n\nHow It Works\n\nGather Game State Data\n\nMake a move\n\nThe Elite Four + Champion\n\nClaude 3 Haiku vs Mixtral 8x7B\n\nClaude 3 Sonnet vs Mistral Large\n\nClaude 3 Opus vs Mistral Large\n\nWinners\n\nLessons learned\n\nLesson 1: Gotta Prompt 'Em All\n\nLesson 2: Models will hallucinate all the time\n\nLesson 3: How to handle poor responses\n\nGet Started with the Code\n\nJoin the Conversation\n\nAs an avid Pokemon player, this is definitely been my favorite experiment\nbuilding with LLMs. When I saw the Pok\u00e9LLMon paper from Georgia Institute of\nTechnology create an agent to do Pokemon battles, I just had to see which\nmodel was the very best. On the surface, Pok\u00e9mon battles may seem simple, with\na limited action space of four moves or switching to one of five other\nPok\u00e9mon. However, the game's depth lies in the countless strategies that arise\nfrom the interplay of 18 Pok\u00e9mon types, unique stats, and more.\n\nExample Pokemon battle\n\nThe question remained: could LLMs use game state information paired with a\nPok\u00e9dex to help them pick the best action? In this post, I'll share 3\nfascinating lessons I learned as LLMs battled their way to the top of the\nPok\u00e9mon League.\n\n##\n\nHow It Works\n\nI was able to use the Poke-env battle simulator to provides an arena for\nautomated battles. The simulator can get the current state of the game such as\nthe stats of the Pok\u00e9mon, move data, and the previous actions taken.\n\nI was then able to setup two LLM agents with Amazon Bedrock to face each other\nin a match. Here is how the test bed works:\n\n###\n\nGather Game State Data\n\nThis current state of the match is translated into text that is added into a\nprompt with all the relevant context for the LLM such as available moves and\nstats, and previous turns.\n\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17\n\nBattle start: Opponent sent out Oranguru. You sent out Lycanroc. Turn 1:\nCurrent battle state: Opponent has 6 pokemons left.\n\nOpposing pokemon:oranguru,Type:Normal and Psychic,HP:100%,Is\ndynamax:False,Attack:158,Defense:193,Special attack:211,Special\ndefense:247,Speed:158,Ability:Inner Focus(The Pok\u00e9mon's intense focus prevents\nit from flinching or being affected by Intimidate.) Bug, Dark-type attack is\nsuper-effective (2x damage) to oranguru. Psychic-type attack is ineffective\n(0.5x damage) to oranguru. Ghost-type attack is zero effect (0x damage) to\noranguru. oranguru's all the possible\nattacks:[psychic,psychic,Power:90],[thunderbolt,electric,Power:90],[focusblast,fighting,Power:120],\n\nYour current pokemon:lycanroc,Type:Rock,HP:100%,Attack:227,Defense:148,Special\nattack:132,Special defense:148,Speed:223(faster than oranguru).Ability:Sand\nRush(Boosts the Pok\u00e9mon's Speed stat in a sandstorm.),Item:Focus Sash(An item\nto be held by a Pok\u00e9mon. If it has full HP, the holder will endure one\npotential KO attack, leaving 1 HP.) Fighting-type attack is super-effective\n(2x damage) to lycanroc. Normal-type attack is ineffective (0.5x damage) to\nlycanroc.\n\nYour lycanroc has 4 moves:\nMove:stoneedge,Type:Rock,Power:118,Acc:80%,Effect:Has an increased chance for\na critical hit.\nMove:psychicfangs,Type:Psychic,Power:100,Acc:100%,Effect:Destroys Reflect and\nLight Screen.(ineffective (0.5x damage) to oranguru)\nMove:closecombat,Type:Fighting,Power:141,Acc:100%,Effect:Lowers the user's\nDefense and Special Defense by one stage after inflicting damage.\nMove:swordsdance,Type:Normal,Status-move,Power:0,Acc:100%,Effect:Raises the\nuser's Attack by two stages.\n\nYou have 5 pokemons: Pokemon:gourgeistsuper,Type:Ghost and\nGrass,HP:100%,Attack:219,Defense:256,Special attack:147,Special\ndefense:176,Speed:96(slower than oranguru). Moves:[powerwhip,Grass,1x\ndamage],[poltergeist,Ghost,0x damage],[rockslide,Rock,1x damage], Electric-\ntype attack is ineffective (0.5x damage) to gourgeistsuper. Normal, Fighting-\ntype attack is zero effect (0x damage) to gourgeistsuper.\n\n###\n\nMake a move\n\nGiven the state of the game, I then ask the LLMs to make the best move. The\nmatches are not in real time so the models do have time to think through their\nactions and not penalized for having slower response times. Here is an example\nresponse from a model given the game state:\n\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n\nBewear is still at full health thanks to not being hit yet. It can probably\nsurvive one boosted attack from Dragonite. The best play is to go for another\nIce Punch, hoping either for a freeze or a high damage roll to KO.\n\nIf Bewear attacks and doesn't KO, it will likely go down next turn. But\nswitching out Bewear gives Dragonite a free turn to keep setting up or attack.\n\nNone of the remaining Pokemon want to take +2 Outrage or Dual Wingbeat damage.\n\nGengar is already fainted so can't switch to it. Cinderace is faster than\nBewear but is very low and will get KOed by any attack. The others are all\nslower and will take huge damage.\n\nTherefore, the best option is to stay in with Bewear and fire off another Ice\nPunch. We need to try to KO that Dragonite before it runs through the team\nwith its boosts. Switching is too risky here.\n\nBewear, finish it off with Ice Punch! No fear! {\"move\":\"Ice Punch\"}\n\nThe environment was able to orchestrate the moves returned in the JSON object\nuntil one side was defeated. Now, let's see how the models stacked up against\neach other.\n\n##\n\nThe Elite Four + Champion\n\nMy previous Street Fighter experiment showed that the Claude models were the\nbest when it came to gaming, so I wanted to see how they stacked up vs the\nMistral models especially Claude Opus which just launched on Amazon Bedrock.\nFor each match up I used the same parameters and system prompt in a generation\n8 best-of-five battle format with random Pok\u00e9mon.\n\n###\n\nClaude 3 Haiku vs Mixtral 8x7B\n\nHaiku won here 3-2. It was a close match, with Haiku showcasing its speed and\nresponsiveness. However, there were instances where Haiku made wrong moves or\nswitched Pok\u00e9mon randomly.\n\n###\n\nClaude 3 Sonnet vs Mistral Large\n\nSonnet won 3-2, another close one that could have gone either way. The models\nseemed to be on par with each other, but Mistral occasionally made mistakes or\nless-than-ideal choices. We'll dive deeper into these inconsistencies later in\nthe post.\n\n###\n\nClaude 3 Opus vs Mistral Large\n\nOpus won 4-1. While Opus took its time to respond, the extra processing paid\noff. It consistently made optimal moves based on the scenario and maintained a\nsteady attacking strategy. In contrast, Mistral would randomly switch Pok\u00e9mon,\nlosing momentum and allowing Opus to capitalize on these missteps.\n\n###\n\nWinners\n\nOpus was declared the champion!!! While being the most powerful model, comes\nwith a higher computational cost. On average it took 21 seconds to pick a move\nvs 3 seconds from Haiku making it 7 times slower. However, when you need top-\ntier performance and intelligence from an LLM, Opus is a clear front runner.\n\nModel| Ranking| Average Speed (seconds)  \n---|---|---  \n\ud83e\udd47 Claude 3 Opus| Champion| 21  \n\ud83e\udd48 Claude 3 Sonnet| Tied 2nd| 10  \n\ud83e\udd48 Mistral Large| Tied 2nd| 8  \n\ud83e\udd49 Claude 3 Haiku| 3rd| 3  \nMixtral 8x7B| 4th| 8  \n  \nWhile I'd need to run more matches to get definitive data, here are the\nlessons I learned from watching the models battle.\n\n##\n\nLessons learned\n\nThe LLM Pok\u00e9mon battles revealed several fascinating aspects of how these\nmodels approach complex tasks, from the importance of prompt engineering to\nthe challenges of dealing with hallucinations and sub optimal decision-making.\nHere are the lessons I learned:\n\n###\n\nLesson 1: Gotta Prompt 'Em All\n\nWhen I initially used the original prompt from the Pok\u00e9LLMon paper tested on\nGPT models with Claude 3 Sonnet, the results were underwhelming, with a mere\n5% win rate against the bot. To improve performance, I crafted a new system\nprompt following best practices, which boosted the win rate to an impressive\n50%.\n\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29\n30 31 32 33 34 35 36 37 38 39 40 41 42\n\nYou are a highly skilled and strategic Pokemon battler. Your primary goal is\nto make optimal move choices and switch decisions to defeat opposing Pokemon\nteams. Focus on knocking out the opposing Pokemon and only switch when\nabsolutely necessary.\n\nYour responses should have a confident, aggressive tone focused on maximizing\ndamage output and securing KOs. Analyze the situation carefully, but\nprioritize attacking moves over switching whenever possible.\n\nGiven the current battle state with your active Pokemon, the opposing Pokemon,\nand any additional battlefield information, decide on the optimal action to\ntake this turn - either choosing an attack move or switching to another\nPokemon on your team if attacking is not viable.\n\nYour decision should factor in:\n\nType advantages/disadvantages Current boosts/debuffs on each Pokemon Entry\nhazards on the field Potential to set up for bigger damage later Revenge\nkilling opportunities Preserving your own Pokemon's health, but not at the\ncost of missing KO opportunities\n\nUse status-boosting moves like swords dance, calm mind, dragon dance, nasty\nplot strategically. The boosting will be reset when pokemon switch out. Set\ntraps like stick yweb, spikes, toxic spikes, stealth rock strategically. When\nfaced with a opponent that is boosting or has already boosted it's\nattack/special attack/speed, knock it out as soon as possible, even\nsacrificing your pokemon.\n\nIf your active Pokemon has a reasonable chance to KO the opponent's Pokemon,\neven if it is low on health, prioritize attacking over switching. \"Panic\nswitching\" will lead to poor outcomes and lost battles, so focus on attacking\nfirst and only switch when your active Pokemon is guaranteed to faint to the\nopponent's next move.\n\nExplain your reasoning step-by-step in arriving at your chosen action,\nemphasizing why attacking is the optimal play whenever possible and why you\nare confident in your choices. <examples> Example 1\n\nYour Mesprit (full HP) vs Opponent's Metagross (7% HP)\n\nThinking process:\n\nMetagross outspeeds Mesprit and can hurt with with Meteor Mash Mesprit's\nPsychic attacks are not very effective against Metagross Attacking has a high\nchance to KO Metagross, whereas switching lets it get off a free hit Even at\nlow HP, Mesprit's best play is to attack\n\nOutput move: Psychic ... </examples>\n\nFor reference here was your last move: {self.last_action}\n\nRemember, your goal is to win. Be decisive and go for KOs whenever possible.\nSwitching should be a last resort, not a go-to option. If you do switch,\nchoose a Pokemon that can threaten the opponent or tank their hits. Seize\nevery opportunity to deal big damage and remove opposing threats from the\nfield. Maintain offensive pressure and don't allow unnecessary free turns.\n\nIf your previous move was a switch think long and hard before saying to switch\nagain, explain why you will make two switches in a row which gives the\nopponent two free moves. Don't worry if the opponent Pokemon is strong because\nof boosts do not switch twice in a row, doing so will cause you to lose the\nmatch. Also, Do not worry about preserving pokemon that will not help in the\nbattle any more, trying to preserve a pokemon that is about to faint will cost\nyou the match. You play to win!!!\n\nThe new prompt really emphasizes don\u2019t switch and provides example of how to\nthink through moves based on the current match up. Also, by giving the model a\nmore \u201caggressive\u201d tone it focused more on attacking and seemed to really get\ninto the battles.\n\n> Therefore, the best move is to attack with Shadow Ball. It has a high chance\n> to OHKO Alakazam from full health, and even if it doesn't, Gengar will\n> survive thanks to Focus Sash and can then finish the job.\n>\n> Don't overthink it - just click Shadow Ball and remove Alakazam from the\n> field immediately.\n\nShadow Ball Hits\n\nThis experience aligns with similar tests that improved Claude 2's accuracy on\nrecalling data from long documents shoot up from 27% to 98% just by adding in\na single phrase to the prompt.\n\nI suspect that the Mistral models' poorer performance might be attributed to\nbad prompting. For further experiments, I plan to follow Mistral's best\npractices for prompting, to ensure a better comparison.\n\n###\n\nLesson 2: Models will hallucinate all the time\n\nThe models hallucinated frequently during the battles. The vast complexity of\nthe Pok\u00e9mon universe, with 18 different types and over 1,000 Pok\u00e9mon, led to\nthe models making logical errors, such as:\n\n  * Stating incorrect type match ups\n\n  * Confusing defense with special defense\n\n  * Forgetting about abilities and held items\n\nHere are some examples of these hallucinations:\n\n  * The optimal play is to maintain offensive pressure with Toxic to cripple Bronzong over time. Then Air Slash for damage while Bronzong is poisoned. Vespiquen should be able to win this matchup without much trouble. (Bronzong is a steel type and immune to poison attacks)\n\n  * Looking at the rest of my team, Arcanine stands out as the best switch-in. It resists Orbeetle's Bug attacks, is immune to its Psychic attacks, and can threaten with super-effective Fire moves like Flare Blitz. (Arcanine is not immune to Psychic attacks)\n\n  * While Blacephalon's Special Attack is boosted, Aurorus has Defense stat of 203, which could help mitigate some of the damage. (Wrong Stat to compare)\n\nBad move using Toixc on Steel Type\n\nThis highlights that as the intelligence required for a task increases, more\ncontext doesn't always help even with stronger models. For high intelligence\ntasks, specialized tools for example a tool that can do battle calculations\nwould be more helpful for the model to use instead of trying to do the \"math'\nitself.\n\n###\n\nLesson 3: How to handle poor responses\n\nDuring the battles I noticed the models would display \"Panic switching\" as\nobserved in the original paper. The LLMs tend to switch Pok\u00e9mon frequently vs\nstrong or stats boosted Pok\u00e9mon, giving their opponents ample time to set up\nand attack, ultimately leading to their defeat. Even with my prompt explicitly\nwarning against this behavior, some models still made consecutive switches,\nallowing their opponents to win with ease.\n\nThe model would even justify that its worth switching:\n\n> I acknowledge switching twice in a row gives Gardevoir free turns to attack.\n> However, preserving Turtonator and swapping in the bulkier, offensive threat\n> in Malamar is worth it to put pressure back on Gardevoir.\n\nThese taught me while prompt engineering, can help outcomes it wont be enough\nto get the desired outcome all the time. In the paper they used a method which\ncompared 3 outputs from the LLM and it chose the best result. These led to a\n7% increase win rate against the bot.\n\nIn the next section, we'll explore how you can try your hand at setting up\nyour own LLM Pok\u00e9mon champion.\n\n##\n\nGet Started with the Code\n\nReady to build your own LLM Pok\u00e9mon master? All the code and documentation you\nneed to get started are available on GitHub. I'm excited to see how the\ncommunity can improve upon this experiment by:\n\n  * Tweaking prompts to optimize LLM performance\n\n  * Trying out different LLMs to find the best contenders\n\n  * Exploring model behaviors to gain deeper insights\n\nIf you're interested in experimenting with the winning Claude 3 models, check\nout my comprehensive getting started guide for detailed instructions and best\npractices.\n\n###\n\nJoin the Conversation\n\nHave an idea for taking this experiment to the next level? Want to share your\nfindings or discuss the implications of LLMs in gaming and beyond? Leave a\ncomment below and let's keep the conversation going!\n\nAny opinions in this post are those of the individual author and may not\nreflect the opinions of AWS.\n\nComments (2)2\n\n## 2 Comments\n\nLog in to comment\n\nHow It Works\n\nGather Game State Data\n\nMake a move\n\nThe Elite Four + Champion\n\nClaude 3 Haiku vs Mixtral 8x7B\n\nClaude 3 Sonnet vs Mistral Large\n\nClaude 3 Opus vs Mistral Large\n\nWinners\n\nLessons learned\n\nLesson 1: Gotta Prompt 'Em All\n\nLesson 2: Models will hallucinate all the time\n\nLesson 3: How to handle poor responses\n\nGet Started with the Code\n\nJoin the Conversation\n\n", "frontpage": false}
