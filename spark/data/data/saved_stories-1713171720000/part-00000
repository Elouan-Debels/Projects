{"aid": "40036686", "title": "Vim Gets XDG_CONFIG_HOME Support", "url": "https://github.com/vim/vim/pull/14182", "domain": "github.com/vim", "votes": 2, "user": "throwaway1194", "posted_at": "2024-04-15 03:00:03", "comments": 0, "source_title": "Add XDG_BASE_DIR support by saccarosium \u00b7 Pull Request #14182 \u00b7 vim/vim", "source_text": "Add XDG_BASE_DIR support by saccarosium \u00b7 Pull Request #14182 \u00b7 vim/vim \u00b7\nGitHub\n\nSkip to content\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\nvim / vim Public\n\n  * Notifications\n  * Fork 5.2k\n  * Star 34.9k\n\nJump to bottom\n\n# Add XDG_BASE_DIR support #14182\n\nClosed\n\nsaccarosium wants to merge 5 commits into vim:master from saccarosium:master\n\nClosed\n\n# Add XDG_BASE_DIR support #14182\n\nsaccarosium wants to merge 5 commits into vim:master from saccarosium:master\n\n+162 \u22122\n\n## Conversation\n\nContributor\n\n###\n\nsaccarosium commented Mar 11, 2024\n\ncontinues: #14167 fixes: #2034\n\nI've added the check for $XDG_CONFIG_HOME.\n\nAdd XDG_CONFIG_HOME/vim/vimrc support\n\n1b69a9a\n\nMember\n\n###\n\nchrisbra commented Mar 11, 2024\n\nThanks. I think we should add something to the documentation, about what\n$XDG_CONFIG_HOME is and where to find it.Then we should probably add something\nto :version, mentioning $XDG_CONFIG_HOME as fourth vimrc File.And finally, I\nsuppose this does not make $XDG_CONFIG_HOME/vim part of the default runtime\ndirectory? That leaves the question, where do I put my other runtime files?  \n---  \n  \nContributor Author\n\n###\n\nsaccarosium commented Mar 12, 2024\n\nI was thinking to introduce full XDG_BASE_DIR in another PR but make sense to\ndo it all here\n\n> I think we should add something to the documentation, about what\n> $XDG_CONFIG_HOME is and where to find it.\n\nYes it is probably a good a idea. Where exacly do you think we should put it\nthis explenation (I'm not super versed on where is the appropriate spot for\nthis information).\n\n> And finally, I suppose this does not make $XDG_CONFIG_HOME/vim part of the\n> default runtime directory? That leaves the question, where do I put my other\n> runtime files?\n\nWe could make a file to put under $VIMRUNTIME/xdg.vim that uses the\nappropriate XDG_BASE_DIR, that will be sourced when we detect that the user is\nusing $XDG_CONFIG_HOME/vim/vimrc. This can also be beneficial for the users\nthat wants to use XDG_BASE_DIR but still wants their vimrc in the home\ndirectory because they would just need to source $VIMRUNTIME/xdg.vim in their\nvimrc.  \n---  \n  \nsaccarosium changed the title Add XDG_CONFIG_HOME/vim/vimrc support Add\nXDG_BASE_DIR support Mar 12, 2024\n\nContributor\n\n###\n\nhabamax commented Mar 12, 2024\n\n> This can also be beneficial for the users that wants to use XDG_BASE_DIR but\n> still wants their vimrc in the home directory because they would just need\n> to source $VIMRUNTIME/xdg.vim in their vimrc.\n\nLet's not introduce yet another defaults.vim.Can we add\n$XDG_CONFIG_HOME/vim/{plugin,after,ftplugin,...etc} to runtime path if\n$XDG_CONFIG_HOME/vim/vimrc was used?PS, do we target Windows ~/AppData/vim/\nhere?  \n---  \n  \nContributor Author\n\n###\n\nsaccarosium commented Mar 12, 2024\n\n> PS, do we target Windows ~/AppData/vim/ here?\n\nIdeally yes, but probably is better to address it in another PR since I don't\nreally know the windows convention.\n\n> Let's not introduce yet another defaults.vim.\n\nWhy not exactly? What is the disadvantage of doing this in your opinion?\n\n> Can we add $XDG_CONFIG_HOME/vim/{plugin,after,ftplugin,...etc} to runtime\n> path if $XDG_CONFIG_HOME/vim/vimrc was used?\n\nI'm not against this just wanna know why the $VIMRUNTIME/xdg.vim is a bad\nidea.  \n---  \n  \nContributor\n\n###\n\nhabamax commented Mar 12, 2024\n\n> > Let's not introduce yet another defaults.vim.\n\n> Why not exactly? What is the disadvantage of doing this in your opinion?\n\nThere might be vim without eval. Or distro maintainer that will not package\nthis .vim file for good(or whatever) reason.defaults.vim caused probably the\nmost user questions in freenode and then libera #vim channel, so whatever new\ndefault with regards to runtimepath to be introduced, it is better be in vim\nsource code.  \n---  \n  \nContributor\n\n###\n\nhabamax commented Mar 12, 2024\n\nI take it, eval shouldn't matter as then your configuration doesn't make sense\nanywhere in filesystem.  \n---  \n  \nContributor Author\n\n###\n\nsaccarosium commented Mar 12, 2024\n\n> And finally, I suppose this does not make $XDG_CONFIG_HOME/vim part of the\n> default runtime directory? That leaves the question, where do I put my other\n> runtime files?\n\nI want to layout what I was thinking for the runtime files layout.First I give\na brief explenation of the XDG varibles with their realative fallbacks:\n\n  * XDG_CONFIG_HOME or $HOME/.config: user configuration\n  * XDG_DATA_HOME or $HOME/.local/share: persistent user data\n  * XDG_CACHE_HOME or $HOME/.cache: ephemiral user data\n\nHaving that in mind I was thinking the following layout:\n\n    \n    \n    XDG_CONFIG_HOME | after/ | autoload/ | ... | vimrc XDG_DATA_HOME | netrwhist | viminfo | ... XDG_CACHE_HOME | undo/ | backup/\n\nFor something like the pack dir, I don't really know where would be the\nappropriate spot. Someone could argue it belongs in XDG_CONFIG_HOME since some\npeople like to have plugin as submodules, neovim user XDG_DATA_HOME.  \n---  \n  \nContributor Author\n\n###\n\nsaccarosium commented Mar 12, 2024\n\n> [...] add $XDG_CONFIG_HOME/vim/{plugin,after,ftplugin,...etc} to runtime\n> path if $XDG_CONFIG_HOME/vim/vimrc was used [...]\n\n@habamax makes sense. It make sense to do it this way.  \n---  \n  \nContributor\n\n###\n\nhabamax commented Mar 12, 2024 \u2022\n\n> For something like the pack dir, I don't really know where would be the\n> appropriate spot. Someone could argue it belongs in XDG_CONFIG_HOME since\n> some people like to have plugin as submodules, neovim user XDG_DATA_HOME.\n\nI consider them the same as ~/.vim/ directory -- config, and put there my own\nconfiguration (filetypes, colorschemes, syntax files) I do for myself and\nwould like them to be separated from ~/.vim/{ftplugin, plugin, colors, syntax,\nindent} to avoid clutter. And it is still in the same .vim repo I can clone on\nanother machine.  \n---  \n  \nMember\n\n###\n\nchrisbra commented Mar 12, 2024\n\nPuh, I am not sure I like this. First of all:\n\n    \n    \n    XDG_CONFIG_HOME | after/ | autoload/ | ... | vimrc XDG_DATA_HOME | netrwhist | viminfo | ... XDG_CACHE_HOME | undo/ | backup/\n\nShouldn't there be a vim directory under which\nundo/backup/viminfo/netrwhist/autoload etc are stored? Else we will be\ncluttering various $XDG_ directories with Vim related files and it's hard to\nfind out what belongs to Vim (which matters if you want to make a backup, or\nmove it to a new pc, etc).Second, personally, I hate ripping apart the\nexisting .vim directory for a similar reason. Nowadays, I can simply go to\n~/.vim and archive it and move it to a new host. In the future I have to\nremember where all potential data for Vim will be stored. That makes my life\nas a user harder.In short, I am not yet convinced we should spread out the\ndata among several directories, even if this is what the freedesktop\nspecification is about.Same for Windows, I wholeheartly hate that I have to\nfind anything below AppData, because it has become like a trash bin and it's\nhard to find the correct place (do I need to go to Local or Roaming? But fine,\nif this is just an alternative directory and I can still use my precious\nvimfiles directory. Oh well...  \n---  \n  \nContributor\n\n###\n\nhabamax commented Mar 13, 2024\n\n> Shouldn't there be a vim directory under which\n> undo/backup/viminfo/netrwhist/autoload etc are stored? Else we will be\n> cluttering various $XDG_ directories with Vim related files and it's hard to\n> find out what belongs to Vim (which matters if you want to make a backup, or\n> move it to a new pc, etc).\n\nI think this is a typo and it should have been XDG_CONFIG_HOME/vim/,\nXDG_DATA_HOME/vim/, etc.\n\n> Second, personally, I hate ripping apart the existing .vim directory for a\n> similar reason. Nowadays, I can simply go to ~/.vim and archive it and move\n> it to a new host. In the future I have to remember where all potential data\n> for Vim will be stored. That makes my life as a user harder.\n\nSame, I would like to have a vim config directory that is easily manageable.\nNot sure about .viminfo -- it is by default saved as ~/.viminfo even if you\nhave ~/.vim/ directory.  \n---  \n  \nContributor Author\n\n###\n\nsaccarosium commented Mar 13, 2024\n\n> Shouldn't there be a vim directory under which\n> undo/backup/viminfo/netrwhist/autoload etc are stored? Else we will be\n> cluttering various $XDG_ directories with Vim related files and it's hard to\n> find out what belongs to Vim (which matters if you want to make a backup, or\n> move it to a new pc, etc).\n\nIt is a typo everything is under a vim directory in the respective XDG\nfolders.\n\n> Second, personally, I hate ripping apart the existing .vim directory for a\n> similar reason. Nowadays, I can simply go to ~/.vim and archive it and move\n> it to a new host. In the future I have to remember where all potential data\n> for Vim will be stored. That makes my life as a user harder.\n\nThis comes down to personal preference of the user. This days a lot of people\ndislike having a lot of file in their home. Also this will be only an option\nif the user activly opt in. A lot of programs do it this way while preserving\ntheir home location by default (tmux, emacs, etc).I think we should have a\nleast the option.Also:\n\n    \n    \n    XDG_CONFIG_HOME | after/ | autoload/ | ... | vimrc XDG_DATA_HOME | netrwhist | viminfo | ... XDG_CACHE_HOME | undo/ | backup/\n\nthis was an idea, is up for debate an modification.  \n---  \n  \n###\n\ndiegoviola commented Mar 13, 2024\n\n@saccarosium Thanks for reviving #14167! Happy to see progress on this.\nCheers.  \n---  \n  \nContributor Author\n\n###\n\nsaccarosium commented Mar 14, 2024\n\n@chrisbra we could just use XDG_CONFIG_HOME/vim as we use $HOME/.vim only if\nwe find a XDG_CONFIG_HOME/vim/vimrc. But I would also put the viminfo in\nXDG_CONFIG_HOME/vim since if the user is using XDG_DIRS they don't want\nclutter in their HOME.  \n---  \n  \n###\n\ndiegoviola commented Mar 15, 2024\n\n@saccarosium @chrisbra What about XDG_STATE_HOME for viminfo and other history\nrelated files?  \n---  \n  \nMember\n\n###\n\nchrisbra commented Mar 15, 2024\n\n> we could just use XDG_CONFIG_HOME/vim as we use $HOME/.vim only if we find a\n> XDG_CONFIG_HOME/vim/vimrc. But I would also put the viminfo in\n> XDG_CONFIG_HOME/vim since if the user is using XDG_DIRS they don't want\n> clutter in their HOME.\n\nThat sounds fine.  \n---  \n  \nMember\n\n###\n\nchrisbra commented Mar 15, 2024\n\n> @saccarosium @chrisbra What about XDG_STATE_HOME for viminfo and other\n> history related files?\n\nAs mentioned before, I don't like scattering around vim folder across various\n$XDG related folders.  \n---  \n  \n###\n\nvim-ml commented Mar 15, 2024 via email\n\nOn 2024-03-15, Christian Brabandt wrote: we could just use XDG_CONFIG_HOME/vim\nas we use $HOME/.vim only if we find a XDG_CONFIG_HOME/vim/vimrc. But I would\nalso put the viminfo in XDG_CONFIG_HOME/vim since if the user is using\nXDG_DIRS they don't want clutter in their HOME. That sounds fine.Except that\nthe contents of ~/.vim is typically shareable among different vim\ninstallations, e.g., on different machines, while files such as ~/.viminfo are\nnot. I use Dropbox and unison to keep my configuration files synced across\nseveral machines. I don't want register contents and command histories shared\namong those machines. If someone wants their viminfo file in some directory\nother than $HOME, they can always rename it in 'viminfo'. Yes, I could do\nthat, too, but I really don't think the viminfo file belongs in the vim\ndirectory. Regards, Gary  \n---  \n  \nMember\n\n###\n\nchrisbra commented Mar 15, 2024\n\nWell true, except when you want your register-contents or search-/ex- history\nshared accross several systems \ud83e\udd37 .So let's leave the viminfo alone for now.\nPeople can already set :set viminfofile= to point it some other location.  \n---  \n  \nghgary reviewed Mar 19, 2024\n\nView reviewed changes\n\nAdd XDG_CONFIG_HOME runtimepath support\n\n54ed71e\n\nsaccarosium force-pushed the master branch from 5d8548f to 54ed71e Compare\nMarch 19, 2024 08:26\n\nContributor Author\n\n###\n\nsaccarosium commented Mar 19, 2024\n\nThis is ready for review. The only thing is missing is some documentation on\nwhat is XDG_CONFIG_HOME or what is XDG.  \n---  \n  \nghgary reviewed Mar 19, 2024\n\nView reviewed changes\n\n###\n\nghgary commented Mar 19, 2024\n\n\":help 'runtimepath'\" also needs to be updated.  \n---  \n  \nchrisbra reviewed Mar 19, 2024\n\nView reviewed changes\n\nchrisbra reviewed Mar 19, 2024\n\nView reviewed changes\n\nMember\n\n###\n\nchrisbra commented Mar 19, 2024\n\nCan we please also have some tests? Have a look at\ngithub.com/vim/vim/blob/master/src/testdir/test_startup.vim  \n---  \n  \nFix typo in XDG_RUNTIMEPATH\n\nfc6605a\n\nchrisbra reviewed Mar 20, 2024\n\nView reviewed changes\n\nsaccarosium force-pushed the master branch from 37c2f0d to 48aeb77 Compare\nMarch 22, 2024 17:05\n\nContributor Author\n\n###\n\nsaccarosium commented Mar 22, 2024\n\nI've added some documentation on freedesktop and xdg. But I don't know how to\nconnect it to 'runtimepath'. I think I need an help on that front.I'll work on\nthe test.  \n---  \n  \nMember\n\n###\n\nchrisbra commented Mar 22, 2024\n\noh great thanks. There are a few typos in the document and we probably don't\nneed it in a separate doc file, but I can fix this when merging. Just a note\nto myself :)  \n---  \n  \nAdding documentation on freedesktop and xdg\n\n37ded4a\n\nsaccarosium force-pushed the master branch from 48aeb77 to 37ded4a Compare\nMarch 24, 2024 17:40\n\nAdd tests for XDG_VIMRC detection\n\na2a413e\n\nContributor Author\n\n###\n\nsaccarosium commented Apr 11, 2024\n\nHi @chrisbra I've made a very simple test case and corrected some typos in the\ndocumentation. I'm not super good yet at writing test so I think I can't add\nanything more useful.I think this can be merged.Also there are some other\nthings we may need to consider:\n\n  * A function that returns the current vim dir location (e.g. $XDG_CONFIG_HOME/vim if they are using the xdg_vimrc or ~/.vim if their using ~/.vimrc/~/.vim/vimrc).\n  * A way in the C code to check what rc is been used.\n\n  \n---  \n  \n###\n\nghgary commented Apr 11, 2024\n\nRather than a function, how about an environment variable? It's much easier to\nuse an environment variable on the command line. $MYVIMRC is used now for the\nconfiguration file; you could use something like $MYVIM or $MYVIMDIR. $MYVIMRC\nshould already be visible in the C code.  \n---  \n  \nMember\n\n###\n\nchrisbra commented Apr 11, 2024\n\nIs there a reason you cannot use echo fnamemodify(expand(\"$MYVIMRC\"), ':p:h')?  \n---  \n  \nContributor Author\n\n###\n\nsaccarosium commented Apr 11, 2024\n\n> Is there a reason you cannot use echo fnamemodify(expand(\"$MYVIMRC\"),\n> ':p:h')?\n\nNope, I didn't know I could do that.  \n---  \n  \n###\n\nghgary commented Apr 11, 2024\n\nThat won't work if $MYVIMRC is ~/.vimrc.  \n---  \n  \nchrisbra closed this in c9df1fb Apr 14, 2024\n\nSign up for free to join this conversation on GitHub. Already have an account?\nSign in to comment\n\nLabels\n\nNone yet\n\n6 participants\n\nAdd this suggestion to a batch that can be applied as a single commit. This\nsuggestion is invalid because no changes were made to the code. Suggestions\ncannot be applied while the pull request is closed. Suggestions cannot be\napplied while viewing a subset of changes. Only one suggestion per line can be\napplied in a batch. Add this suggestion to a batch that can be applied as a\nsingle commit. Applying suggestions on deleted lines is not supported. You\nmust change the existing code in this line in order to create a valid\nsuggestion. Outdated suggestions cannot be applied. This suggestion has been\napplied or marked resolved. Suggestions cannot be applied from pending\nreviews. Suggestions cannot be applied on multi-line comments. Suggestions\ncannot be applied while the pull request is queued to merge. Suggestion cannot\nbe applied right now. Please check back later.\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
