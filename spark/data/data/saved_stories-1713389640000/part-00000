{"aid": "40066152", "title": "pythondoneright.md", "url": "https://gist.github.com/MuhsinFatih/ee0154199803babb449b5bb98d3475f7", "domain": "gist.github.com", "votes": 2, "user": "surprisetalk", "posted_at": "2024-04-17 15:32:38", "comments": 0, "source_title": "How to recover from messed up python installation on mac, and never have to mess with apple's shitty python confusion factory", "source_text": "How to recover from messed up python installation on mac, and never have to\nmess with apple's shitty python confusion factory \u00b7 GitHub\n\nSkip to content\n\nSign in Sign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\nInstantly share code, notes, and snippets.\n\n# MuhsinFatih/pythondoneright.md\n\nLast active April 16, 2024 16:17\n\nShow Gist options\n\n  * Download ZIP\n\n  * Star 181 You must be signed in to star a gist\n  * Fork 16 You must be signed in to fork a gist\n\n  *     * Learn more about clone URLs\n\n  * Save MuhsinFatih/ee0154199803babb449b5bb98d3475f7 to your computer and use it in GitHub Desktop.\n\n  * Learn more about clone URLs\n\nSave MuhsinFatih/ee0154199803babb449b5bb98d3475f7 to your computer and use it\nin GitHub Desktop.\n\nDownload ZIP\n\nHow to recover from messed up python installation on mac, and never have to\nmess with apple's shitty python confusion factory\n\nRaw\n\npythondoneright.md\n\nI am assuming you are here because like me, you installed a bazillion\ndifferent python interpreters on mac and the whole thing is a spagetti. Today,\nI finally fixed my python installation. Whatever I install for python2 or\npython3 using pip JUST.WORKS.. My god! finally.\n\n## What the hell?\n\nHere is what I had messed up, which you also probably did:\n\n  * I had too many different python interpreters\n  * Too many different symlinks which I lost track of\n  * almost no package I installed with pip worked without a headache\n  * any attempt to fix using online resources made it worse.\n\n## Let's set things right\n\n  * First, remove all the python packages you installed. I am not sure if this is really necessary, but I did it just so I get a fresh start\n\n    \n    \n    pip uninstall -y -r <(pip freeze)\n\n(source: https://stackoverflow.com/a/49200334/2770195)\n\n  * Also remove pip cache because why not:\n\n    \n    \n    ~/Library/Caches/pip\n\n  * Now remove pip\n\n    \n    \n    pip uninstall pip\n\n  * Remove all the third party python installations: Careful! Don't delete anything under the /System/ folder. Otherwise you WILL have to reinstall macos, it WILL crash, don't do it.\n\n    \n    \n    sudo rm -rf /Library/Frameworks/Python.framework sudo rm -rf \"/Applications/Python 2.7\" cd /usr/local/bin/ ls -l /usr/local/bin | grep '../Library/Frameworks/Python.framework/Versions/2.7' | awk '{print $9}' | tr -d @ | xargs rm\n\n(source: https://stackoverflow.com/a/3819829/2770195 but I changed it a bit to\nremove python3 too)\n\n  * Remove python path stuff Edit whatever shell profile you have, like .bash_profile or .zshrc and .zprofile or whichever shell you are using (If you don't know what I'm talking about then it's .bash_profile): Delete all lines that have Python.framework in it. In other words, delete old paths related to python.\n\n    \n    \n    nano .bash_profile\n\n(source: https://stackoverflow.com/a/3819829/2770195 again)\n\n  * If you have anaconda installed, get rid of that too:\n\n    \n    \n    rm -rf ~/anaconda*\n\n(source: https://docs.anaconda.com/anaconda/install/uninstall/)\n\nSo far all this was standard. What's important is how you install the new\nversion. Here's the fun part: if you already messed up your python\nenvironment, then there is a good chance you messed up permissions with some\npackages too. Thus any attempt to install new python versions will seem to\nwork fine for now, but will be a brat later on. That's why the next step is so\nimportant:\n\n  * Fix old package permissions:\n\n    \n    \n    sudo chown -R $USER /usr/local/bin/*\n\nBasically, everything in this folder is supposed to NOT require root\npriviliges, which if they do they give pip a hard time later on. That's why we\nmade everything belong to us\n\n## Let's install the one and only python2 we will use!:\n\n(don't worry we will get to python3 as well) Now that you fixed the\npermissions, you can go ahead and install a python2 interpreter that will NOT\never require sudo with pip and hence will install your packages just fine:\nHere is the trick: We are NOT using easy_install. Got it? No easy_install.\nIt's the devil. brew is love, use brew:\n\n  * If you don't have brew installed (firstly you should be ashamed of yourself):\n\n    \n    \n    /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n\nGo to your .profile file again\n\n    \n    \n    nano .bash_profile\n\nand add these lines:\n\n> \u26a0 (If you're using macos on arm, add these two lines instead):\n>  \n>  \n>     export PATH=\"/usr/local/bin:/usr/local/sbin:$PATH\" export\n> PATH=\"/opt/homebrew/opt/python@2/libexec/bin:$PATH\"\n    \n    \n    export PATH=\"/usr/local/bin:/usr/local/sbin:$PATH\" export PATH=\"/usr/local/opt/python@2/libexec/bin:$PATH\"\n\n[UPDATE: crossed python2 installation as it is no longer relevant] now install\npython2 using brew: brew install python@2 (this will also install pip)\n(source: https://docs.python-guide.org/starting/install/osx/)\n\n## Install python3\n\n    \n    \n    brew install python\n\n(this installs latests python, which is right now python3. Also installs pip)\n\nOk, if you haven't screwed up anything so far, you should be able to use pip\nwith a peace of mind. I just tried a bunch of packages like numpy and plotly\nthey all worked right away\n\n## Golden rule\n\nIf you want to maintain the serenity that you have just gained, you have to\nremember one rule: Never ever use sudo pip install. sudo is the biggest source\nof confusion with python packages as it screws up the permissions. This is not\nonly true for python, but also nodejs for example, and other environments.\nThere are a lot of posts online that use sudo pip to install packages in their\ninstructions. Always omit the sudo part of that instruction. If you ever\naccidentally use sudo pip, come back here and apply the steps related to\npermissions again\n\ngg wp. Now do me a favor and end aging before I die. Just saying. Have fun.\n\nAuthor\n\n###\n\nMuhsinFatih commented May 5, 2022\n\n> Any ideas where to go from here?\n\n@nathansmithbz You should be fine skipping the pip uninstall since we're\nmanually deleting everything that's python-related later in the other steps.\nMy approach was to nuke everything using every possible option I can quickly\nthink of. Probably 30-50% of the steps are redundant but harms not.\n\n> After a day of frustration, most of what you listed worked. There was one\n> failure (can't remember) which I ignored and carried on. Yay. You rock!\n\n@arosielle Thanks! Just like my answer right above, some of the steps are\nactually redundant so ignoring errors should be fine in most cases\n\n> I am on the same boat, want to clean my mac of all the useless pieces I\n> installed. I am following your guide and while trying to run the following\n> command - I get this error\n\n@aceabhinavam Try sudo xargs rm at the end of that command. Or xargs sudo rm?\nI don't really know. One of these should work\n\n###\n\nsvahora commented May 6, 2022\n\nI'm trying to fix my install as well. Most of the time when I'm using VS Code\nto install packages it gives me an error and I end up spending hours trying to\nfix it all just to install a simple python library. Afterwards I usually give\nup :( The following is what I have for those queries requested to others:\n\nSV$ which python /usr/bin/python SV$ which python2 /usr/bin/python2 SV$ which\npython3 /usr/bin/python3 SV$ which pip /usr/local/bin/pip SV$ which pip2 / SV$\nwhich pip3 /usr/bin/pip3 SV$ pip2 -V -bash: pip2: command not found SV$ pip3\n-V pip 19.0.3 from\n/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/site-\npackages/pip (python 3.7) SV$ pip -V -bash: /usr/local/bin/pip:\n/usr/local/opt/python/bin/python3.7: bad interpreter: No such file or\ndirectory\n\n###\n\nAllPinkyNoBrain commented Jul 11, 2022\n\nthankyou thankyou thankyou thankyou !!!\n\nI was going mad with all this (and I'd stupidly thrown in an upgrade to\nMonterey in the midst of my madness). This has made my day! :-)\n\n###\n\ncrukundo commented Aug 15, 2022\n\nJust incase anyone finds this in 2022, and can't install python2 with\nhomebrew, some of the threads here\n(https://stackoverflow.com/questions/60298514/how-to-reinstall-python2-from-\nhomebrew) might help. I used pyenv and reinstalled pip independently on\npython2 and 3\n\n###\n\nTyler-Pickett commented Aug 16, 2022\n\nAfter running pip uninstall -y -r <(pip freeze)\n\nI get this error code, everything up to gets deleted. PermissionError: [Errno\n13] Permission denied:\n'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/site-\npackages/__pycache__/six.cpython-37.pyc'\n\nEven though I am admin, I come up as staff when I run ls -la\n\n###\n\ndasheck0 commented Oct 3, 2022\n\nThought my system was beyond repair. This actually fixed it. Thank you so\nmuch!\n\n###\n\ngpmilliken commented Oct 14, 2022\n\nThanks - got some traceback errors along the way but this worked and the\nmadness of installed modules not being found has stopped.\n\nThank you.\n\n###\n\ncwilby commented Nov 21, 2022\n\nSome considerations for macOS on ARM:\n\n> and add these lines:\n>\n> export PATH=\"/usr/local/bin:/usr/local/sbin:$PATH\" export\n> PATH=\"/usr/local/opt/python@2/libexec/bin:$PATH\"\n\ntranslates as\n\n> and add these lines:\n>\n> export PATH=\"/usr/local/bin:/usr/local/sbin:$PATH\" export\n> PATH=\"/opt/homebrew/opt/python@2/libexec/bin:$PATH\"\n\nAuthor\n\n###\n\nMuhsinFatih commented Nov 22, 2022\n\nThanks @cwilby, I just checked and the path is as you said on my mac (arm).\nUpdated the gist\n\n###\n\narmouti commented Jan 23, 2023\n\nthis is outdated brew install python@2 will return Error: No available formula\nwith the name \"python@2\" because it has been removed by homebrew\nHomebrew/homebrew-core#49796\n\nAuthor\n\n###\n\nMuhsinFatih commented Jan 23, 2023\n\n> this is outdated brew install python@2 will return Error: No available\n> formula with the name \"python@2\" because it has been removed by homebrew\n> Homebrew/homebrew-core#49796\n\n@armouti replace that with just python and you should be good. Noone uses\npython2 anymore\n\n###\n\nyin-ori commented Feb 10, 2023\n\nI installed pyenv virtualvenv after I had to completely resetup my setup.\nwhich pip/pip3/python/python3 all direct to the correct environment path,\nthough, once I try to install packages it will still create packages in a path\nof homebrew library for python3.10 (which I don't even have anymore) - I am\nnot sure if its something wrong along with my .zshcr zprofile bash or\nsomething else and cannot find anything that works for me on the internet\neither. $PATH will give me zsh: no such file or directory:\n/Users/MYUSERNAME/.pyenv/shims:/Users/MYUSERNAME/.pyenv/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Library/TeX/texbin:/usr/local/go/bin:/Library/Apple/usr/bin\n\nsee also this: python packages installed to wrong path\n\nbtw even if I delete the folder it will recreate itself upon installation :(\n\n###\n\nUncleBob2 commented Feb 24, 2023\n\nThank you so much for sharing your knowledge. I had lot of issues with \"pip\ninstall TTS\" and was getting lots of warnings\n\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/PyYAML-6.0-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/numpy-1.24.2-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/PyYAML-6.0-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/numpy-1.24.2-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/PyYAML-6.0-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/numpy-1.24.2-py3.11.egg-info due to invalid metadata entry 'name'\"\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/PyYAML-6.0-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/numpy-1.24.2-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/PyYAML-6.0-py3.11.egg-info due to invalid metadata entry 'name'\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/PyYAML-6.0-py3.11.egg-info due to invalid metadata entry 'name'\n\nEverything seems to be working now. Many thanks\n\n###\n\nMaxistheSpy commented Apr 8, 2023\n\n> > this is outdated brew install python@2 will return Error: No available\n> formula with the name \"python@2\" because it has been removed by homebrew\n> Homebrew/homebrew-core#49796\n>\n> @armouti replace that with just python and you should be good. Noone uses\n> python2 anymore\n\nany chance you could update the gude then, since homebrew doesnt even support\nthis installation its confusing\n\nAuthor\n\n###\n\nMuhsinFatih commented Apr 10, 2023\n\n> > > this is outdated brew install python@2 will return Error: No available\n> formula with the name \"python@2\" because it has been removed by homebrew\n> Homebrew/homebrew-core#49796\n>>\n\n>> @armouti replace that with just python and you should be good. Noone uses\npython2 anymore\n\n>\n> any chance you could update the gude then, since homebrew doesnt even\n> support this installation its confusing\n\ndone.\n\n###\n\ndwqualia commented Apr 17, 2023\n\nI followed this exactly on Ventura 13.3 but I keep getting this error?\n\nWARNING: Skipping /usr/local/lib/python3.11/site-\npackages/PyYAML-6.0-py3.11.egg-info due to invalid metadata entry 'name'\n\nHow can I fix this?\n\n###\n\nbrownj47 commented May 24, 2023\n\nI am having the same issue as @dwqualia. Could it be an issue with the\nPyYAML-6.0 package?\n\nAuthor\n\n###\n\nMuhsinFatih commented May 24, 2023\n\n@brownj47 @dwqualia probably an issue with pyyaml. you can install a different\nversion of python. 3.11 is the latest python so some packages might be\nunstable.\n\n    \n    \n    brew install python@3.10\n\n###\n\nDrjacky commented Jun 4, 2023\n\n> @brownj47 @dwqualia probably an issue with pyyaml. you can install a\n> different version of python. 3.11 is the latest python so some packages\n> might be unstable.\n>  \n>  \n>     brew install python@3.10\n\nI'm on the latest 3.11.3 and still have the issue.\n\n###\n\nalessandraluz commented Jun 22, 2023\n\nOh. my. god. thank you for avoiding my impending life ending, by helping me\nwith this incredible step by step!!!\n\n###\n\nvictorazzam commented Jul 14, 2023\n\nTo fix the PyYAML issue:\n\n  1. Uninstall it with pythonXXX -m pip uninstall -y pyyaml\n  2. Erase its path with rm -r /opt/homebrew/lib/pythonXXX/site-packages/PyYAML*\n\nFor both commands, replace XXX with the correct Python version for which the\nproblem occurs.\n\n###\n\nMichaelDerrenbacher commented Aug 31, 2023\n\nThank you for this! I had a patchwork python env, and this helped me get\neverything freshly installed\n\n###\n\ngumbolastima commented Oct 14, 2023\n\nI had a problem following these instructions, where removing the frameworks\ngave lots of \"permission denied\" errors. To solve it, I changed the command\n\nls -l /usr/local/bin | grep '../Library/Frameworks/Python.framework/Versions/2.7' | awk '{print $9}' | tr -d @ | xargs rm\n\nto\n\nsudo sh -c \"ls -l /usr/local/bin | grep '../Library/Frameworks/Python.framework/Versions/2.7' | awk '{print \\$9}' | tr -d @ | xargs rm\"\n\n###\n\nrudraksh97 commented Dec 12, 2023\n\nThis thread saved me. I had to complete a python assignment for an interview\nand libraries weren't just installing. Big thanks!!\n\n###\n\nmshonichev commented Feb 8, 2024 \u2022\n\nI'm not sure how I got here, but this is huge!\n\ngg indeed!\n\n###\n\ndrumstick90 commented Feb 20, 2024\n\nThank you so much! I also think installing packages by VSC isn't a good idea,\nI'd rather stick to pip install\n\n###\n\njdbohrman commented Mar 12, 2024\n\nYou are a fucking champ.\n\n###\n\nfranco-stuart commented Mar 22, 2024\n\nWith pip freeze, I get this error:\n\n    \n    \n    Traceback (most recent call last): File \"/opt/homebrew/bin/pip\", line 5, in <module> from pip._internal.cli.main import main ModuleNotFoundError: No module named 'pip'\n\n###\n\nFetchFast commented Apr 1, 2024\n\nShouldn't containers make all of this unnecessary?\n\n###\n\nAwesomeguys900 commented Apr 8, 2024\n\nI actually love you so much\n\nSign up for free to join this conversation on GitHub. Already have an account?\nSign in to comment\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
